#!/usr/bin/env node
import{createRequire as C4}from"node:module";var eg=Object.create;var{getPrototypeOf:x4,defineProperty:nx,getOwnPropertyNames:g4}=Object;var $4=Object.prototype.hasOwnProperty;var s=(x,g,$)=>{$=x!=null?eg(x4(x)):{};let C=g||!x||!x.__esModule?nx($,"default",{value:x,enumerable:!0}):$;for(let G of g4(x))if(!$4.call(C,G))nx(C,G,{get:()=>x[G],enumerable:!0});return C};var w=(x,g)=>()=>(g||x((g={exports:{}}).exports,g),g.exports);var u=C4(import.meta.url);var W1=w((s9,E0)=>{var x0=process||{},bx=x0.argv||[],e1=x0.env||{},G4=!(!!e1.NO_COLOR||bx.includes("--no-color"))&&(!!e1.FORCE_COLOR||bx.includes("--color")||x0.platform==="win32"||(x0.stdout||{}).isTTY&&e1.TERM!=="dumb"||!!e1.CI),N4=(x,g,$=x)=>(C)=>{let G=""+C,N=G.indexOf(g,x.length);return~N?x+J4(G,g,$,N)+g:x+G+g},J4=(x,g,$,C)=>{let G="",N=0;do G+=x.substring(N,C)+$,N=C+g.length,C=x.indexOf(g,N);while(~C);return G+x.substring(N)},dx=(x=G4)=>{let g=x?N4:()=>String;return{isColorSupported:x,reset:g("\x1B[0m","\x1B[0m"),bold:g("\x1B[1m","\x1B[22m","\x1B[22m\x1B[1m"),dim:g("\x1B[2m","\x1B[22m","\x1B[22m\x1B[2m"),italic:g("\x1B[3m","\x1B[23m"),underline:g("\x1B[4m","\x1B[24m"),inverse:g("\x1B[7m","\x1B[27m"),hidden:g("\x1B[8m","\x1B[28m"),strikethrough:g("\x1B[9m","\x1B[29m"),black:g("\x1B[30m","\x1B[39m"),red:g("\x1B[31m","\x1B[39m"),green:g("\x1B[32m","\x1B[39m"),yellow:g("\x1B[33m","\x1B[39m"),blue:g("\x1B[34m","\x1B[39m"),magenta:g("\x1B[35m","\x1B[39m"),cyan:g("\x1B[36m","\x1B[39m"),white:g("\x1B[37m","\x1B[39m"),gray:g("\x1B[90m","\x1B[39m"),bgBlack:g("\x1B[40m","\x1B[49m"),bgRed:g("\x1B[41m","\x1B[49m"),bgGreen:g("\x1B[42m","\x1B[49m"),bgYellow:g("\x1B[43m","\x1B[49m"),bgBlue:g("\x1B[44m","\x1B[49m"),bgMagenta:g("\x1B[45m","\x1B[49m"),bgCyan:g("\x1B[46m","\x1B[49m"),bgWhite:g("\x1B[47m","\x1B[49m"),blackBright:g("\x1B[90m","\x1B[39m"),redBright:g("\x1B[91m","\x1B[39m"),greenBright:g("\x1B[92m","\x1B[39m"),yellowBright:g("\x1B[93m","\x1B[39m"),blueBright:g("\x1B[94m","\x1B[39m"),magentaBright:g("\x1B[95m","\x1B[39m"),cyanBright:g("\x1B[96m","\x1B[39m"),whiteBright:g("\x1B[97m","\x1B[39m"),bgBlackBright:g("\x1B[100m","\x1B[49m"),bgRedBright:g("\x1B[101m","\x1B[49m"),bgGreenBright:g("\x1B[102m","\x1B[49m"),bgYellowBright:g("\x1B[103m","\x1B[49m"),bgBlueBright:g("\x1B[104m","\x1B[49m"),bgMagentaBright:g("\x1B[105m","\x1B[49m"),bgCyanBright:g("\x1B[106m","\x1B[49m"),bgWhiteBright:g("\x1B[107m","\x1B[49m")}};E0.exports=dx();E0.exports.createColors=dx});var n0=w((a9,ix)=>{var w0={to(x,g){if(!g)return`\x1B[${x+1}G`;return`\x1B[${g+1};${x+1}H`},move(x,g){let $="";if(x<0)$+=`\x1B[${-x}D`;else if(x>0)$+=`\x1B[${x}C`;if(g<0)$+=`\x1B[${-g}A`;else if(g>0)$+=`\x1B[${g}B`;return $},up:(x=1)=>`\x1B[${x}A`,down:(x=1)=>`\x1B[${x}B`,forward:(x=1)=>`\x1B[${x}C`,backward:(x=1)=>`\x1B[${x}D`,nextLine:(x=1)=>"\x1B[E".repeat(x),prevLine:(x=1)=>"\x1B[F".repeat(x),left:"\x1B[G",hide:"\x1B[?25l",show:"\x1B[?25h",save:"\x1B7",restore:"\x1B8"},I4={up:(x=1)=>"\x1B[S".repeat(x),down:(x=1)=>"\x1B[T".repeat(x)},Z4={screen:"\x1B[2J",up:(x=1)=>"\x1B[1J".repeat(x),down:(x=1)=>"\x1B[J".repeat(x),line:"\x1B[2K",lineEnd:"\x1B[K",lineStart:"\x1B[1K",lines(x){let g="";for(let $=0;$<x;$++)g+=this.line+($<x-1?w0.up():"");if(x)g+=w0.left;return g}};ix.exports={cursor:w0,scroll:I4,erase:Z4,beep:"\x07"}});var N1=w((S6,p2)=>{var k2=["nodebuffer","arraybuffer","fragments"],c2=typeof Blob<"u";if(c2)k2.push("blob");p2.exports={BINARY_TYPES:k2,CLOSE_TIMEOUT:30000,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:c2,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}});var d1=w((W6,U0)=>{var{EMPTY_BUFFER:r3}=N1(),Vx=Buffer[Symbol.species];function t3(x,g){if(x.length===0)return r3;if(x.length===1)return x[0];let $=Buffer.allocUnsafe(g),C=0;for(let G=0;G<x.length;G++){let N=x[G];$.set(N,C),C+=N.length}if(C<g)return new Vx($.buffer,$.byteOffset,C);return $}function o2(x,g,$,C,G){for(let N=0;N<G;N++)$[C+N]=x[N]^g[N&3]}function s2(x,g){for(let $=0;$<x.length;$++)x[$]^=g[$&3]}function e3(x){if(x.length===x.buffer.byteLength)return x.buffer;return x.buffer.slice(x.byteOffset,x.byteOffset+x.length)}function Ox(x){if(Ox.readOnly=!0,Buffer.isBuffer(x))return x;let g;if(x instanceof ArrayBuffer)g=new Vx(x);else if(ArrayBuffer.isView(x))g=new Vx(x.buffer,x.byteOffset,x.byteLength);else g=Buffer.from(x),Ox.readOnly=!1;return g}U0.exports={concat:t3,mask:o2,toArrayBuffer:e3,toBuffer:Ox,unmask:s2};if(!process.env.WS_NO_BUFFER_UTIL)try{let x=(()=>{throw new Error("Cannot require module "+"bufferutil");})();U0.exports.mask=function(g,$,C,G,N){if(N<48)o2(g,$,C,G,N);else x.mask(g,$,C,G,N)},U0.exports.unmask=function(g,$){if(g.length<32)s2(g,$);else x.unmask(g,$)}}catch(x){}});var e2=w((m6,t2)=>{var a2=Symbol("kDone"),Rx=Symbol("kRun");class r2{constructor(x){this[a2]=()=>{this.pending--,this[Rx]()},this.concurrency=x||1/0,this.jobs=[],this.pending=0}add(x){this.jobs.push(x),this[Rx]()}[Rx](){if(this.pending===this.concurrency)return;if(this.jobs.length){let x=this.jobs.shift();this.pending++,x(this[a2])}}}t2.exports=r2});var h1=w((v6,Gg)=>{var i1=u("zlib"),xg=d1(),x$=e2(),{kStatusCode:gg}=N1(),g$=Buffer[Symbol.species],$$=Buffer.from([0,0,255,255]),D0=Symbol("permessage-deflate"),J1=Symbol("total-length"),A1=Symbol("callback"),X1=Symbol("buffers"),T1=Symbol("error"),B0;class $g{constructor(x,g,$){if(this._maxPayload=$|0,this._options=x||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!g,this._deflate=null,this._inflate=null,this.params=null,!B0){let C=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;B0=new x$(C)}}static get extensionName(){return"permessage-deflate"}offer(){let x={};if(this._options.serverNoContextTakeover)x.server_no_context_takeover=!0;if(this._options.clientNoContextTakeover)x.client_no_context_takeover=!0;if(this._options.serverMaxWindowBits)x.server_max_window_bits=this._options.serverMaxWindowBits;if(this._options.clientMaxWindowBits)x.client_max_window_bits=this._options.clientMaxWindowBits;else if(this._options.clientMaxWindowBits==null)x.client_max_window_bits=!0;return x}accept(x){return x=this.normalizeParams(x),this.params=this._isServer?this.acceptAsServer(x):this.acceptAsClient(x),this.params}cleanup(){if(this._inflate)this._inflate.close(),this._inflate=null;if(this._deflate){let x=this._deflate[A1];if(this._deflate.close(),this._deflate=null,x)x(Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(x){let g=this._options,$=x.find((C)=>{if(g.serverNoContextTakeover===!1&&C.server_no_context_takeover||C.server_max_window_bits&&(g.serverMaxWindowBits===!1||typeof g.serverMaxWindowBits==="number"&&g.serverMaxWindowBits>C.server_max_window_bits)||typeof g.clientMaxWindowBits==="number"&&!C.client_max_window_bits)return!1;return!0});if(!$)throw Error("None of the extension offers can be accepted");if(g.serverNoContextTakeover)$.server_no_context_takeover=!0;if(g.clientNoContextTakeover)$.client_no_context_takeover=!0;if(typeof g.serverMaxWindowBits==="number")$.server_max_window_bits=g.serverMaxWindowBits;if(typeof g.clientMaxWindowBits==="number")$.client_max_window_bits=g.clientMaxWindowBits;else if($.client_max_window_bits===!0||g.clientMaxWindowBits===!1)delete $.client_max_window_bits;return $}acceptAsClient(x){let g=x[0];if(this._options.clientNoContextTakeover===!1&&g.client_no_context_takeover)throw Error('Unexpected parameter "client_no_context_takeover"');if(!g.client_max_window_bits){if(typeof this._options.clientMaxWindowBits==="number")g.client_max_window_bits=this._options.clientMaxWindowBits}else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits==="number"&&g.client_max_window_bits>this._options.clientMaxWindowBits)throw Error('Unexpected or invalid parameter "client_max_window_bits"');return g}normalizeParams(x){return x.forEach((g)=>{Object.keys(g).forEach(($)=>{let C=g[$];if(C.length>1)throw Error(`Parameter "${$}" must have only a single value`);if(C=C[0],$==="client_max_window_bits"){if(C!==!0){let G=+C;if(!Number.isInteger(G)||G<8||G>15)throw TypeError(`Invalid value for parameter "${$}": ${C}`);C=G}else if(!this._isServer)throw TypeError(`Invalid value for parameter "${$}": ${C}`)}else if($==="server_max_window_bits"){let G=+C;if(!Number.isInteger(G)||G<8||G>15)throw TypeError(`Invalid value for parameter "${$}": ${C}`);C=G}else if($==="client_no_context_takeover"||$==="server_no_context_takeover"){if(C!==!0)throw TypeError(`Invalid value for parameter "${$}": ${C}`)}else throw Error(`Unknown parameter "${$}"`);g[$]=C})}),x}decompress(x,g,$){B0.add((C)=>{this._decompress(x,g,(G,N)=>{C(),$(G,N)})})}compress(x,g,$){B0.add((C)=>{this._compress(x,g,(G,N)=>{C(),$(G,N)})})}_decompress(x,g,$){let C=this._isServer?"client":"server";if(!this._inflate){let G=`${C}_max_window_bits`,N=typeof this.params[G]!=="number"?i1.Z_DEFAULT_WINDOWBITS:this.params[G];this._inflate=i1.createInflateRaw({...this._options.zlibInflateOptions,windowBits:N}),this._inflate[D0]=this,this._inflate[J1]=0,this._inflate[X1]=[],this._inflate.on("error",G$),this._inflate.on("data",Cg)}if(this._inflate[A1]=$,this._inflate.write(x),g)this._inflate.write($$);this._inflate.flush(()=>{let G=this._inflate[T1];if(G){this._inflate.close(),this._inflate=null,$(G);return}let N=xg.concat(this._inflate[X1],this._inflate[J1]);if(this._inflate._readableState.endEmitted)this._inflate.close(),this._inflate=null;else if(this._inflate[J1]=0,this._inflate[X1]=[],g&&this.params[`${C}_no_context_takeover`])this._inflate.reset();$(null,N)})}_compress(x,g,$){let C=this._isServer?"server":"client";if(!this._deflate){let G=`${C}_max_window_bits`,N=typeof this.params[G]!=="number"?i1.Z_DEFAULT_WINDOWBITS:this.params[G];this._deflate=i1.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:N}),this._deflate[J1]=0,this._deflate[X1]=[],this._deflate.on("data",C$)}this._deflate[A1]=$,this._deflate.write(x),this._deflate.flush(i1.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let G=xg.concat(this._deflate[X1],this._deflate[J1]);if(g)G=new g$(G.buffer,G.byteOffset,G.length-4);if(this._deflate[A1]=null,this._deflate[J1]=0,this._deflate[X1]=[],g&&this.params[`${C}_no_context_takeover`])this._deflate.reset();$(null,G)})}}Gg.exports=$g;function C$(x){this[X1].push(x),this[J1]+=x.length}function Cg(x){if(this[J1]+=x.length,this[D0]._maxPayload<1||this[J1]<=this[D0]._maxPayload){this[X1].push(x);return}this[T1]=RangeError("Max payload size exceeded"),this[T1].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[T1][gg]=1009,this.removeListener("data",Cg),this.reset()}function G$(x){if(this[D0]._inflate=null,this[T1]){this[A1](this[T1]);return}x[gg]=1007,this[A1](x)}});var L1=w((y6,A0)=>{var{isUtf8:Ng}=u("buffer"),{hasBlob:N$}=N1(),J$=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function I$(x){return x>=1000&&x<=1014&&x!==1004&&x!==1005&&x!==1006||x>=3000&&x<=4999}function qx(x){let g=x.length,$=0;while($<g)if((x[$]&128)===0)$++;else if((x[$]&224)===192){if($+1===g||(x[$+1]&192)!==128||(x[$]&254)===192)return!1;$+=2}else if((x[$]&240)===224){if($+2>=g||(x[$+1]&192)!==128||(x[$+2]&192)!==128||x[$]===224&&(x[$+1]&224)===128||x[$]===237&&(x[$+1]&224)===160)return!1;$+=3}else if((x[$]&248)===240){if($+3>=g||(x[$+1]&192)!==128||(x[$+2]&192)!==128||(x[$+3]&192)!==128||x[$]===240&&(x[$+1]&240)===128||x[$]===244&&x[$+1]>143||x[$]>244)return!1;$+=4}else return!1;return!0}function Z$(x){return N$&&typeof x==="object"&&typeof x.arrayBuffer==="function"&&typeof x.type==="string"&&typeof x.stream==="function"&&(x[Symbol.toStringTag]==="Blob"||x[Symbol.toStringTag]==="File")}A0.exports={isBlob:Z$,isValidStatusCode:I$,isValidUTF8:qx,tokenChars:J$};if(Ng)A0.exports.isValidUTF8=function(x){return x.length<24?qx(x):Ng(x)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let x=(()=>{throw new Error("Cannot require module "+"utf-8-validate");})();A0.exports.isValidUTF8=function(g){return g.length<32?qx(g):x(g)}}catch(x){}});var Bx=w((u6,Xg)=>{var{Writable:Q$}=u("stream"),Jg=h1(),{BINARY_TYPES:X$,EMPTY_BUFFER:Ig,kStatusCode:z$,kWebSocket:j$}=N1(),{concat:Ux,toArrayBuffer:K$,unmask:Y$}=d1(),{isValidStatusCode:H$,isValidUTF8:Zg}=L1(),T0=Buffer[Symbol.species];class Qg extends Q${constructor(x={}){super();this._allowSynchronousEvents=x.allowSynchronousEvents!==void 0?x.allowSynchronousEvents:!0,this._binaryType=x.binaryType||X$[0],this._extensions=x.extensions||{},this._isServer=!!x.isServer,this._maxPayload=x.maxPayload|0,this._skipUTF8Validation=!!x.skipUTF8Validation,this[j$]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=0}_write(x,g,$){if(this._opcode===8&&this._state==0)return $();this._bufferedBytes+=x.length,this._buffers.push(x),this.startLoop($)}consume(x){if(this._bufferedBytes-=x,x===this._buffers[0].length)return this._buffers.shift();if(x<this._buffers[0].length){let $=this._buffers[0];return this._buffers[0]=new T0($.buffer,$.byteOffset+x,$.length-x),new T0($.buffer,$.byteOffset,x)}let g=Buffer.allocUnsafe(x);do{let $=this._buffers[0],C=g.length-x;if(x>=$.length)g.set(this._buffers.shift(),C);else g.set(new Uint8Array($.buffer,$.byteOffset,x),C),this._buffers[0]=new T0($.buffer,$.byteOffset+x,$.length-x);x-=$.length}while(x>0);return g}startLoop(x){this._loop=!0;do switch(this._state){case 0:this.getInfo(x);break;case 1:this.getPayloadLength16(x);break;case 2:this.getPayloadLength64(x);break;case 3:this.getMask();break;case 4:this.getData(x);break;case 5:case 6:this._loop=!1;return}while(this._loop);if(!this._errored)x()}getInfo(x){if(this._bufferedBytes<2){this._loop=!1;return}let g=this.consume(2);if((g[0]&48)!==0){let C=this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");x(C);return}let $=(g[0]&64)===64;if($&&!this._extensions[Jg.extensionName]){let C=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");x(C);return}if(this._fin=(g[0]&128)===128,this._opcode=g[0]&15,this._payloadLength=g[1]&127,this._opcode===0){if($){let C=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");x(C);return}if(!this._fragmented){let C=this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");x(C);return}this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented){let C=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");x(C);return}this._compressed=$}else if(this._opcode>7&&this._opcode<11){if(!this._fin){let C=this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");x(C);return}if($){let C=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");x(C);return}if(this._payloadLength>125||this._opcode===8&&this._payloadLength===1){let C=this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");x(C);return}}else{let C=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");x(C);return}if(!this._fin&&!this._fragmented)this._fragmented=this._opcode;if(this._masked=(g[1]&128)===128,this._isServer){if(!this._masked){let C=this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK");x(C);return}}else if(this._masked){let C=this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");x(C);return}if(this._payloadLength===126)this._state=1;else if(this._payloadLength===127)this._state=2;else this.haveLength(x)}getPayloadLength16(x){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(x)}getPayloadLength64(x){if(this._bufferedBytes<8){this._loop=!1;return}let g=this.consume(8),$=g.readUInt32BE(0);if($>Math.pow(2,21)-1){let C=this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH");x(C);return}this._payloadLength=$*Math.pow(2,32)+g.readUInt32BE(4),this.haveLength(x)}haveLength(x){if(this._payloadLength&&this._opcode<8){if(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0){let g=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");x(g);return}}if(this._masked)this._state=3;else this._state=4}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=4}getData(x){let g=Ig;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}if(g=this.consume(this._payloadLength),this._masked&&(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])!==0)Y$(g,this._mask)}if(this._opcode>7){this.controlMessage(g,x);return}if(this._compressed){this._state=5,this.decompress(g,x);return}if(g.length)this._messageLength=this._totalPayloadLength,this._fragments.push(g);this.dataMessage(x)}decompress(x,g){this._extensions[Jg.extensionName].decompress(x,this._fin,(C,G)=>{if(C)return g(C);if(G.length){if(this._messageLength+=G.length,this._messageLength>this._maxPayload&&this._maxPayload>0){let N=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");g(N);return}this._fragments.push(G)}if(this.dataMessage(g),this._state===0)this.startLoop(g)})}dataMessage(x){if(!this._fin){this._state=0;return}let g=this._messageLength,$=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let C;if(this._binaryType==="nodebuffer")C=Ux($,g);else if(this._binaryType==="arraybuffer")C=K$(Ux($,g));else if(this._binaryType==="blob")C=new Blob($);else C=$;if(this._allowSynchronousEvents)this.emit("message",C,!0),this._state=0;else this._state=6,setImmediate(()=>{this.emit("message",C,!0),this._state=0,this.startLoop(x)})}else{let C=Ux($,g);if(!this._skipUTF8Validation&&!Zg(C)){let G=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");x(G);return}if(this._state===5||this._allowSynchronousEvents)this.emit("message",C,!1),this._state=0;else this._state=6,setImmediate(()=>{this.emit("message",C,!1),this._state=0,this.startLoop(x)})}}controlMessage(x,g){if(this._opcode===8){if(x.length===0)this._loop=!1,this.emit("conclude",1005,Ig),this.end();else{let $=x.readUInt16BE(0);if(!H$($)){let G=this.createError(RangeError,`invalid status code ${$}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");g(G);return}let C=new T0(x.buffer,x.byteOffset+2,x.length-2);if(!this._skipUTF8Validation&&!Zg(C)){let G=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");g(G);return}this._loop=!1,this.emit("conclude",$,C),this.end()}this._state=0;return}if(this._allowSynchronousEvents)this.emit(this._opcode===9?"ping":"pong",x),this._state=0;else this._state=6,setImmediate(()=>{this.emit(this._opcode===9?"ping":"pong",x),this._state=0,this.startLoop(g)})}createError(x,g,$,C,G){this._loop=!1,this._errored=!0;let N=new x($?`Invalid WebSocket frame: ${g}`:g);return Error.captureStackTrace(N,this.createError),N.code=G,N[z$]=C,N}}Xg.exports=Qg});var Ax=w((l6,Kg)=>{var{Duplex:f6}=u("stream"),{randomFillSync:M$}=u("crypto"),zg=h1(),{EMPTY_BUFFER:V$,kWebSocket:O$,NOOP:R$}=N1(),{isBlob:_1,isValidStatusCode:q$}=L1(),{mask:jg,toBuffer:O1}=d1(),o=Symbol("kByteLength"),U$=Buffer.alloc(4),R1,P1=8192,r=0,B$=1,D$=2;class z1{constructor(x,g,$){if(this._extensions=g||{},$)this._generateMask=$,this._maskBuffer=Buffer.alloc(4);this._socket=x,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=r,this.onerror=R$,this[O$]=void 0}static frame(x,g){let $,C=!1,G=2,N=!1;if(g.mask){if($=g.maskBuffer||U$,g.generateMask)g.generateMask($);else{if(P1===8192){if(R1===void 0)R1=Buffer.alloc(8192);M$(R1,0,8192),P1=0}$[0]=R1[P1++],$[1]=R1[P1++],$[2]=R1[P1++],$[3]=R1[P1++]}N=($[0]|$[1]|$[2]|$[3])===0,G=6}let J;if(typeof x==="string")if((!g.mask||N)&&g[o]!==void 0)J=g[o];else x=Buffer.from(x),J=x.length;else J=x.length,C=g.mask&&g.readOnly&&!N;let I=J;if(J>=65536)G+=8,I=127;else if(J>125)G+=2,I=126;let Z=Buffer.allocUnsafe(C?J+G:G);if(Z[0]=g.fin?g.opcode|128:g.opcode,g.rsv1)Z[0]|=64;if(Z[1]=I,I===126)Z.writeUInt16BE(J,2);else if(I===127)Z[2]=Z[3]=0,Z.writeUIntBE(J,4,6);if(!g.mask)return[Z,x];if(Z[1]|=128,Z[G-4]=$[0],Z[G-3]=$[1],Z[G-2]=$[2],Z[G-1]=$[3],N)return[Z,x];if(C)return jg(x,$,Z,G,J),[Z];return jg(x,$,x,0,J),[Z,x]}close(x,g,$,C){let G;if(x===void 0)G=V$;else if(typeof x!=="number"||!q$(x))throw TypeError("First argument must be a valid error code number");else if(g===void 0||!g.length)G=Buffer.allocUnsafe(2),G.writeUInt16BE(x,0);else{let J=Buffer.byteLength(g);if(J>123)throw RangeError("The message must not be greater than 123 bytes");if(G=Buffer.allocUnsafe(2+J),G.writeUInt16BE(x,0),typeof g==="string")G.write(g,2);else G.set(g,2)}let N={[o]:G.length,fin:!0,generateMask:this._generateMask,mask:$,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};if(this._state!==r)this.enqueue([this.dispatch,G,!1,N,C]);else this.sendFrame(z1.frame(G,N),C)}ping(x,g,$){let C,G;if(typeof x==="string")C=Buffer.byteLength(x),G=!1;else if(_1(x))C=x.size,G=!1;else x=O1(x),C=x.length,G=O1.readOnly;if(C>125)throw RangeError("The data size must not be greater than 125 bytes");let N={[o]:C,fin:!0,generateMask:this._generateMask,mask:g,maskBuffer:this._maskBuffer,opcode:9,readOnly:G,rsv1:!1};if(_1(x))if(this._state!==r)this.enqueue([this.getBlobData,x,!1,N,$]);else this.getBlobData(x,!1,N,$);else if(this._state!==r)this.enqueue([this.dispatch,x,!1,N,$]);else this.sendFrame(z1.frame(x,N),$)}pong(x,g,$){let C,G;if(typeof x==="string")C=Buffer.byteLength(x),G=!1;else if(_1(x))C=x.size,G=!1;else x=O1(x),C=x.length,G=O1.readOnly;if(C>125)throw RangeError("The data size must not be greater than 125 bytes");let N={[o]:C,fin:!0,generateMask:this._generateMask,mask:g,maskBuffer:this._maskBuffer,opcode:10,readOnly:G,rsv1:!1};if(_1(x))if(this._state!==r)this.enqueue([this.getBlobData,x,!1,N,$]);else this.getBlobData(x,!1,N,$);else if(this._state!==r)this.enqueue([this.dispatch,x,!1,N,$]);else this.sendFrame(z1.frame(x,N),$)}send(x,g,$){let C=this._extensions[zg.extensionName],G=g.binary?2:1,N=g.compress,J,I;if(typeof x==="string")J=Buffer.byteLength(x),I=!1;else if(_1(x))J=x.size,I=!1;else x=O1(x),J=x.length,I=O1.readOnly;if(this._firstFragment){if(this._firstFragment=!1,N&&C&&C.params[C._isServer?"server_no_context_takeover":"client_no_context_takeover"])N=J>=C._threshold;this._compress=N}else N=!1,G=0;if(g.fin)this._firstFragment=!0;let Z={[o]:J,fin:g.fin,generateMask:this._generateMask,mask:g.mask,maskBuffer:this._maskBuffer,opcode:G,readOnly:I,rsv1:N};if(_1(x))if(this._state!==r)this.enqueue([this.getBlobData,x,this._compress,Z,$]);else this.getBlobData(x,this._compress,Z,$);else if(this._state!==r)this.enqueue([this.dispatch,x,this._compress,Z,$]);else this.dispatch(x,this._compress,Z,$)}getBlobData(x,g,$,C){this._bufferedBytes+=$[o],this._state=D$,x.arrayBuffer().then((G)=>{if(this._socket.destroyed){let J=Error("The socket was closed while the blob was being read");process.nextTick(Dx,this,J,C);return}this._bufferedBytes-=$[o];let N=O1(G);if(!g)this._state=r,this.sendFrame(z1.frame(N,$),C),this.dequeue();else this.dispatch(N,g,$,C)}).catch((G)=>{process.nextTick(A$,this,G,C)})}dispatch(x,g,$,C){if(!g){this.sendFrame(z1.frame(x,$),C);return}let G=this._extensions[zg.extensionName];this._bufferedBytes+=$[o],this._state=B$,G.compress(x,$.fin,(N,J)=>{if(this._socket.destroyed){let I=Error("The socket was closed while data was being compressed");Dx(this,I,C);return}this._bufferedBytes-=$[o],this._state=r,$.readOnly=!1,this.sendFrame(z1.frame(J,$),C),this.dequeue()})}dequeue(){while(this._state===r&&this._queue.length){let x=this._queue.shift();this._bufferedBytes-=x[3][o],Reflect.apply(x[0],this,x.slice(1))}}enqueue(x){this._bufferedBytes+=x[3][o],this._queue.push(x)}sendFrame(x,g){if(x.length===2)this._socket.cork(),this._socket.write(x[0]),this._socket.write(x[1],g),this._socket.uncork();else this._socket.write(x[0],g)}}Kg.exports=z1;function Dx(x,g,$){if(typeof $==="function")$(g);for(let C=0;C<x._queue.length;C++){let G=x._queue[C],N=G[G.length-1];if(typeof N==="function")N(g)}}function A$(x,g,$){Dx(x,g,$),x.onerror(g)}});var Bg=w((E6,Ug)=>{var{kForOnEventAttribute:k1,kListener:Tx}=N1(),Yg=Symbol("kCode"),Hg=Symbol("kData"),Mg=Symbol("kError"),Vg=Symbol("kMessage"),Og=Symbol("kReason"),F1=Symbol("kTarget"),Rg=Symbol("kType"),qg=Symbol("kWasClean");class j1{constructor(x){this[F1]=null,this[Rg]=x}get target(){return this[F1]}get type(){return this[Rg]}}Object.defineProperty(j1.prototype,"target",{enumerable:!0});Object.defineProperty(j1.prototype,"type",{enumerable:!0});class S1 extends j1{constructor(x,g={}){super(x);this[Yg]=g.code===void 0?0:g.code,this[Og]=g.reason===void 0?"":g.reason,this[qg]=g.wasClean===void 0?!1:g.wasClean}get code(){return this[Yg]}get reason(){return this[Og]}get wasClean(){return this[qg]}}Object.defineProperty(S1.prototype,"code",{enumerable:!0});Object.defineProperty(S1.prototype,"reason",{enumerable:!0});Object.defineProperty(S1.prototype,"wasClean",{enumerable:!0});class c1 extends j1{constructor(x,g={}){super(x);this[Mg]=g.error===void 0?null:g.error,this[Vg]=g.message===void 0?"":g.message}get error(){return this[Mg]}get message(){return this[Vg]}}Object.defineProperty(c1.prototype,"error",{enumerable:!0});Object.defineProperty(c1.prototype,"message",{enumerable:!0});class _0 extends j1{constructor(x,g={}){super(x);this[Hg]=g.data===void 0?null:g.data}get data(){return this[Hg]}}Object.defineProperty(_0.prototype,"data",{enumerable:!0});var T$={addEventListener(x,g,$={}){for(let G of this.listeners(x))if(!$[k1]&&G[Tx]===g&&!G[k1])return;let C;if(x==="message")C=function(N,J){let I=new _0("message",{data:J?N:N.toString()});I[F1]=this,L0(g,this,I)};else if(x==="close")C=function(N,J){let I=new S1("close",{code:N,reason:J.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});I[F1]=this,L0(g,this,I)};else if(x==="error")C=function(N){let J=new c1("error",{error:N,message:N.message});J[F1]=this,L0(g,this,J)};else if(x==="open")C=function(){let N=new j1("open");N[F1]=this,L0(g,this,N)};else return;if(C[k1]=!!$[k1],C[Tx]=g,$.once)this.once(x,C);else this.on(x,C)},removeEventListener(x,g){for(let $ of this.listeners(x))if($[Tx]===g&&!$[k1]){this.removeListener(x,$);break}}};Ug.exports={CloseEvent:S1,ErrorEvent:c1,Event:j1,EventTarget:T$,MessageEvent:_0};function L0(x,g,$){if(typeof x==="object"&&x.handleEvent)x.handleEvent.call(x,$);else x.call(g,$)}});var Lx=w((w6,Dg)=>{var{tokenChars:p1}=L1();function $1(x,g,$){if(x[g]===void 0)x[g]=[$];else x[g].push($)}function L$(x){let g=Object.create(null),$=Object.create(null),C=!1,G=!1,N=!1,J,I,Z=-1,Q=-1,K=-1,X=0;for(;X<x.length;X++)if(Q=x.charCodeAt(X),J===void 0)if(K===-1&&p1[Q]===1){if(Z===-1)Z=X}else if(X!==0&&(Q===32||Q===9)){if(K===-1&&Z!==-1)K=X}else if(Q===59||Q===44){if(Z===-1)throw SyntaxError(`Unexpected character at index ${X}`);if(K===-1)K=X;let M=x.slice(Z,K);if(Q===44)$1(g,M,$),$=Object.create(null);else J=M;Z=K=-1}else throw SyntaxError(`Unexpected character at index ${X}`);else if(I===void 0)if(K===-1&&p1[Q]===1){if(Z===-1)Z=X}else if(Q===32||Q===9){if(K===-1&&Z!==-1)K=X}else if(Q===59||Q===44){if(Z===-1)throw SyntaxError(`Unexpected character at index ${X}`);if(K===-1)K=X;if($1($,x.slice(Z,K),!0),Q===44)$1(g,J,$),$=Object.create(null),J=void 0;Z=K=-1}else if(Q===61&&Z!==-1&&K===-1)I=x.slice(Z,X),Z=K=-1;else throw SyntaxError(`Unexpected character at index ${X}`);else if(G){if(p1[Q]!==1)throw SyntaxError(`Unexpected character at index ${X}`);if(Z===-1)Z=X;else if(!C)C=!0;G=!1}else if(N)if(p1[Q]===1){if(Z===-1)Z=X}else if(Q===34&&Z!==-1)N=!1,K=X;else if(Q===92)G=!0;else throw SyntaxError(`Unexpected character at index ${X}`);else if(Q===34&&x.charCodeAt(X-1)===61)N=!0;else if(K===-1&&p1[Q]===1){if(Z===-1)Z=X}else if(Z!==-1&&(Q===32||Q===9)){if(K===-1)K=X}else if(Q===59||Q===44){if(Z===-1)throw SyntaxError(`Unexpected character at index ${X}`);if(K===-1)K=X;let M=x.slice(Z,K);if(C)M=M.replace(/\\/g,""),C=!1;if($1($,I,M),Q===44)$1(g,J,$),$=Object.create(null),J=void 0;I=void 0,Z=K=-1}else throw SyntaxError(`Unexpected character at index ${X}`);if(Z===-1||N||Q===32||Q===9)throw SyntaxError("Unexpected end of input");if(K===-1)K=X;let Y=x.slice(Z,K);if(J===void 0)$1(g,Y,$);else{if(I===void 0)$1($,Y,!0);else if(C)$1($,I,Y.replace(/\\/g,""));else $1($,I,Y);$1(g,J,$)}return g}function _$(x){return Object.keys(x).map((g)=>{let $=x[g];if(!Array.isArray($))$=[$];return $.map((C)=>{return[g].concat(Object.keys(C).map((G)=>{let N=C[G];if(!Array.isArray(N))N=[N];return N.map((J)=>J===!0?G:`${G}=${J}`).join("; ")})).join("; ")}).join(", ")}).join(", ")}Dg.exports={format:_$,parse:L$}});var W0=w((d6,ug)=>{var P$=u("events"),F$=u("https"),S$=u("http"),Lg=u("net"),W$=u("tls"),{randomBytes:m$,createHash:v$}=u("crypto"),{Duplex:n6,Readable:b6}=u("stream"),{URL:_x}=u("url"),K1=h1(),y$=Bx(),u$=Ax(),{isBlob:f$}=L1(),{BINARY_TYPES:Ag,CLOSE_TIMEOUT:l$,EMPTY_BUFFER:P0,GUID:E$,kForOnEventAttribute:Px,kListener:w$,kStatusCode:n$,kWebSocket:f,NOOP:_g}=N1(),{EventTarget:{addEventListener:b$,removeEventListener:d$}}=Bg(),{format:i$,parse:h$}=Lx(),{toBuffer:k$}=d1(),Pg=Symbol("kAborted"),Fx=[8,13],I1=["CONNECTING","OPEN","CLOSING","CLOSED"],c$=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/;class T extends P${constructor(x,g,$){super();if(this._binaryType=Ag[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=P0,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=T.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,x!==null){if(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,g===void 0)g=[];else if(!Array.isArray(g))if(typeof g==="object"&&g!==null)$=g,g=[];else g=[g];Fg(this,x,g,$)}else this._autoPong=$.autoPong,this._closeTimeout=$.closeTimeout,this._isServer=!0}get binaryType(){return this._binaryType}set binaryType(x){if(!Ag.includes(x))return;if(this._binaryType=x,this._receiver)this._receiver._binaryType=x}get bufferedAmount(){if(!this._socket)return this._bufferedAmount;return this._socket._writableState.length+this._sender._bufferedBytes}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(x,g,$){let C=new y$({allowSynchronousEvents:$.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:$.maxPayload,skipUTF8Validation:$.skipUTF8Validation}),G=new u$(x,this._extensions,$.generateMask);if(this._receiver=C,this._sender=G,this._socket=x,C[f]=this,G[f]=this,x[f]=this,C.on("conclude",s$),C.on("drain",a$),C.on("error",r$),C.on("message",t$),C.on("ping",e$),C.on("pong",x9),G.onerror=g9,x.setTimeout)x.setTimeout(0);if(x.setNoDelay)x.setNoDelay();if(g.length>0)x.unshift(g);x.on("close",mg),x.on("data",S0),x.on("end",vg),x.on("error",yg),this._readyState=T.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=T.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}if(this._extensions[K1.extensionName])this._extensions[K1.extensionName].cleanup();this._receiver.removeAllListeners(),this._readyState=T.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(x,g){if(this.readyState===T.CLOSED)return;if(this.readyState===T.CONNECTING){i(this,this._req,"WebSocket was closed before the connection was established");return}if(this.readyState===T.CLOSING){if(this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted))this._socket.end();return}this._readyState=T.CLOSING,this._sender.close(x,g,!this._isServer,($)=>{if($)return;if(this._closeFrameSent=!0,this._closeFrameReceived||this._receiver._writableState.errorEmitted)this._socket.end()}),Wg(this)}pause(){if(this.readyState===T.CONNECTING||this.readyState===T.CLOSED)return;this._paused=!0,this._socket.pause()}ping(x,g,$){if(this.readyState===T.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof x==="function")$=x,x=g=void 0;else if(typeof g==="function")$=g,g=void 0;if(typeof x==="number")x=x.toString();if(this.readyState!==T.OPEN){Sx(this,x,$);return}if(g===void 0)g=!this._isServer;this._sender.ping(x||P0,g,$)}pong(x,g,$){if(this.readyState===T.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof x==="function")$=x,x=g=void 0;else if(typeof g==="function")$=g,g=void 0;if(typeof x==="number")x=x.toString();if(this.readyState!==T.OPEN){Sx(this,x,$);return}if(g===void 0)g=!this._isServer;this._sender.pong(x||P0,g,$)}resume(){if(this.readyState===T.CONNECTING||this.readyState===T.CLOSED)return;if(this._paused=!1,!this._receiver._writableState.needDrain)this._socket.resume()}send(x,g,$){if(this.readyState===T.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof g==="function")$=g,g={};if(typeof x==="number")x=x.toString();if(this.readyState!==T.OPEN){Sx(this,x,$);return}let C={binary:typeof x!=="string",mask:!this._isServer,compress:!0,fin:!0,...g};if(!this._extensions[K1.extensionName])C.compress=!1;this._sender.send(x||P0,C,$)}terminate(){if(this.readyState===T.CLOSED)return;if(this.readyState===T.CONNECTING){i(this,this._req,"WebSocket was closed before the connection was established");return}if(this._socket)this._readyState=T.CLOSING,this._socket.destroy()}}Object.defineProperty(T,"CONNECTING",{enumerable:!0,value:I1.indexOf("CONNECTING")});Object.defineProperty(T.prototype,"CONNECTING",{enumerable:!0,value:I1.indexOf("CONNECTING")});Object.defineProperty(T,"OPEN",{enumerable:!0,value:I1.indexOf("OPEN")});Object.defineProperty(T.prototype,"OPEN",{enumerable:!0,value:I1.indexOf("OPEN")});Object.defineProperty(T,"CLOSING",{enumerable:!0,value:I1.indexOf("CLOSING")});Object.defineProperty(T.prototype,"CLOSING",{enumerable:!0,value:I1.indexOf("CLOSING")});Object.defineProperty(T,"CLOSED",{enumerable:!0,value:I1.indexOf("CLOSED")});Object.defineProperty(T.prototype,"CLOSED",{enumerable:!0,value:I1.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach((x)=>{Object.defineProperty(T.prototype,x,{enumerable:!0})});["open","error","close","message"].forEach((x)=>{Object.defineProperty(T.prototype,`on${x}`,{enumerable:!0,get(){for(let g of this.listeners(x))if(g[Px])return g[w$];return null},set(g){for(let $ of this.listeners(x))if($[Px]){this.removeListener(x,$);break}if(typeof g!=="function")return;this.addEventListener(x,g,{[Px]:!0})}})});T.prototype.addEventListener=b$;T.prototype.removeEventListener=d$;ug.exports=T;function Fg(x,g,$,C){let G={allowSynchronousEvents:!0,autoPong:!0,closeTimeout:l$,protocolVersion:Fx[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...C,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(x._autoPong=G.autoPong,x._closeTimeout=G.closeTimeout,!Fx.includes(G.protocolVersion))throw RangeError(`Unsupported protocol version: ${G.protocolVersion} (supported versions: ${Fx.join(", ")})`);let N;if(g instanceof _x)N=g;else try{N=new _x(g)}catch(z){throw SyntaxError(`Invalid URL: ${g}`)}if(N.protocol==="http:")N.protocol="ws:";else if(N.protocol==="https:")N.protocol="wss:";x._url=N.href;let J=N.protocol==="wss:",I=N.protocol==="ws+unix:",Z;if(N.protocol!=="ws:"&&!J&&!I)Z=`The URL's protocol must be one of "ws:", "wss:", "http:", "https:", or "ws+unix:"`;else if(I&&!N.pathname)Z="The URL's pathname is empty";else if(N.hash)Z="The URL contains a fragment identifier";if(Z){let z=SyntaxError(Z);if(x._redirects===0)throw z;else{F0(x,z);return}}let Q=J?443:80,K=m$(16).toString("base64"),X=J?F$.request:S$.request,Y=new Set,M;if(G.createConnection=G.createConnection||(J?o$:p$),G.defaultPort=G.defaultPort||Q,G.port=N.port||Q,G.host=N.hostname.startsWith("[")?N.hostname.slice(1,-1):N.hostname,G.headers={...G.headers,"Sec-WebSocket-Version":G.protocolVersion,"Sec-WebSocket-Key":K,Connection:"Upgrade",Upgrade:"websocket"},G.path=N.pathname+N.search,G.timeout=G.handshakeTimeout,G.perMessageDeflate)M=new K1(G.perMessageDeflate!==!0?G.perMessageDeflate:{},!1,G.maxPayload),G.headers["Sec-WebSocket-Extensions"]=i$({[K1.extensionName]:M.offer()});if($.length){for(let z of $){if(typeof z!=="string"||!c$.test(z)||Y.has(z))throw SyntaxError("An invalid or duplicated subprotocol was specified");Y.add(z)}G.headers["Sec-WebSocket-Protocol"]=$.join(",")}if(G.origin)if(G.protocolVersion<13)G.headers["Sec-WebSocket-Origin"]=G.origin;else G.headers.Origin=G.origin;if(N.username||N.password)G.auth=`${N.username}:${N.password}`;if(I){let z=G.path.split(":");G.socketPath=z[0],G.path=z[1]}let j;if(G.followRedirects){if(x._redirects===0){x._originalIpc=I,x._originalSecure=J,x._originalHostOrSocketPath=I?G.socketPath:N.host;let z=C&&C.headers;if(C={...C,headers:{}},z)for(let[O,q]of Object.entries(z))C.headers[O.toLowerCase()]=q}else if(x.listenerCount("redirect")===0){let z=I?x._originalIpc?G.socketPath===x._originalHostOrSocketPath:!1:x._originalIpc?!1:N.host===x._originalHostOrSocketPath;if(!z||x._originalSecure&&!J){if(delete G.headers.authorization,delete G.headers.cookie,!z)delete G.headers.host;G.auth=void 0}}if(G.auth&&!C.headers.authorization)C.headers.authorization="Basic "+Buffer.from(G.auth).toString("base64");if(j=x._req=X(G),x._redirects)x.emit("redirect",x.url,j)}else j=x._req=X(G);if(G.timeout)j.on("timeout",()=>{i(x,j,"Opening handshake has timed out")});if(j.on("error",(z)=>{if(j===null||j[Pg])return;j=x._req=null,F0(x,z)}),j.on("response",(z)=>{let O=z.headers.location,q=z.statusCode;if(O&&G.followRedirects&&q>=300&&q<400){if(++x._redirects>G.maxRedirects){i(x,j,"Maximum redirects exceeded");return}j.abort();let B;try{B=new _x(O,g)}catch(D){let L=SyntaxError(`Invalid URL: ${O}`);F0(x,L);return}Fg(x,B,$,C)}else if(!x.emit("unexpected-response",j,z))i(x,j,`Unexpected server response: ${z.statusCode}`)}),j.on("upgrade",(z,O,q)=>{if(x.emit("upgrade",z),x.readyState!==T.CONNECTING)return;j=x._req=null;let B=z.headers.upgrade;if(B===void 0||B.toLowerCase()!=="websocket"){i(x,O,"Invalid Upgrade header");return}let D=v$("sha1").update(K+E$).digest("base64");if(z.headers["sec-websocket-accept"]!==D){i(x,O,"Invalid Sec-WebSocket-Accept header");return}let L=z.headers["sec-websocket-protocol"],A;if(L!==void 0){if(!Y.size)A="Server sent a subprotocol but none was requested";else if(!Y.has(L))A="Server sent an invalid subprotocol"}else if(Y.size)A="Server sent no subprotocol";if(A){i(x,O,A);return}if(L)x._protocol=L;let P=z.headers["sec-websocket-extensions"];if(P!==void 0){if(!M){i(x,O,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let V;try{V=h$(P)}catch(y){i(x,O,"Invalid Sec-WebSocket-Extensions header");return}let R=Object.keys(V);if(R.length!==1||R[0]!==K1.extensionName){i(x,O,"Server indicated an extension that was not requested");return}try{M.accept(V[K1.extensionName])}catch(y){i(x,O,"Invalid Sec-WebSocket-Extensions header");return}x._extensions[K1.extensionName]=M}x.setSocket(O,q,{allowSynchronousEvents:G.allowSynchronousEvents,generateMask:G.generateMask,maxPayload:G.maxPayload,skipUTF8Validation:G.skipUTF8Validation})}),G.finishRequest)G.finishRequest(j,x);else j.end()}function F0(x,g){x._readyState=T.CLOSING,x._errorEmitted=!0,x.emit("error",g),x.emitClose()}function p$(x){return x.path=x.socketPath,Lg.connect(x)}function o$(x){if(x.path=void 0,!x.servername&&x.servername!=="")x.servername=Lg.isIP(x.host)?"":x.host;return W$.connect(x)}function i(x,g,$){x._readyState=T.CLOSING;let C=Error($);if(Error.captureStackTrace(C,i),g.setHeader){if(g[Pg]=!0,g.abort(),g.socket&&!g.socket.destroyed)g.socket.destroy();process.nextTick(F0,x,C)}else g.destroy(C),g.once("error",x.emit.bind(x,"error")),g.once("close",x.emitClose.bind(x))}function Sx(x,g,$){if(g){let C=f$(g)?g.size:k$(g).length;if(x._socket)x._sender._bufferedBytes+=C;else x._bufferedAmount+=C}if($){let C=Error(`WebSocket is not open: readyState ${x.readyState} (${I1[x.readyState]})`);process.nextTick($,C)}}function s$(x,g){let $=this[f];if($._closeFrameReceived=!0,$._closeMessage=g,$._closeCode=x,$._socket[f]===void 0)return;if($._socket.removeListener("data",S0),process.nextTick(Sg,$._socket),x===1005)$.close();else $.close(x,g)}function a$(){let x=this[f];if(!x.isPaused)x._socket.resume()}function r$(x){let g=this[f];if(g._socket[f]!==void 0)g._socket.removeListener("data",S0),process.nextTick(Sg,g._socket),g.close(x[n$]);if(!g._errorEmitted)g._errorEmitted=!0,g.emit("error",x)}function Tg(){this[f].emitClose()}function t$(x,g){this[f].emit("message",x,g)}function e$(x){let g=this[f];if(g._autoPong)g.pong(x,!this._isServer,_g);g.emit("ping",x)}function x9(x){this[f].emit("pong",x)}function Sg(x){x.resume()}function g9(x){let g=this[f];if(g.readyState===T.CLOSED)return;if(g.readyState===T.OPEN)g._readyState=T.CLOSING,Wg(g);if(this._socket.end(),!g._errorEmitted)g._errorEmitted=!0,g.emit("error",x)}function Wg(x){x._closeTimer=setTimeout(x._socket.destroy.bind(x._socket),x._closeTimeout)}function mg(){let x=this[f];if(this.removeListener("close",mg),this.removeListener("data",S0),this.removeListener("end",vg),x._readyState=T.CLOSING,!this._readableState.endEmitted&&!x._closeFrameReceived&&!x._receiver._writableState.errorEmitted&&this._readableState.length!==0){let g=this.read(this._readableState.length);x._receiver.write(g)}if(x._receiver.end(),this[f]=void 0,clearTimeout(x._closeTimer),x._receiver._writableState.finished||x._receiver._writableState.errorEmitted)x.emitClose();else x._receiver.on("error",Tg),x._receiver.on("finish",Tg)}function S0(x){if(!this[f]._receiver.write(x))this.pause()}function vg(){let x=this[f];x._readyState=T.CLOSING,x._receiver.end(),this.end()}function yg(){let x=this[f];if(this.removeListener("error",yg),this.on("error",_g),x)x._readyState=T.CLOSING,this.destroy()}});var wg=w((h6,Eg)=>{var i6=W0(),{Duplex:$9}=u("stream");function fg(x){x.emit("close")}function C9(){if(!this.destroyed&&this._writableState.finished)this.destroy()}function lg(x){if(this.removeListener("error",lg),this.destroy(),this.listenerCount("error")===0)this.emit("error",x)}function G9(x,g){let $=!0,C=new $9({...g,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return x.on("message",function(N,J){let I=!J&&C._readableState.objectMode?N.toString():N;if(!C.push(I))x.pause()}),x.once("error",function(N){if(C.destroyed)return;$=!1,C.destroy(N)}),x.once("close",function(){if(C.destroyed)return;C.push(null)}),C._destroy=function(G,N){if(x.readyState===x.CLOSED){N(G),process.nextTick(fg,C);return}let J=!1;if(x.once("error",function(Z){J=!0,N(Z)}),x.once("close",function(){if(!J)N(G);process.nextTick(fg,C)}),$)x.terminate()},C._final=function(G){if(x.readyState===x.CONNECTING){x.once("open",function(){C._final(G)});return}if(x._socket===null)return;if(x._socket._writableState.finished){if(G(),C._readableState.endEmitted)C.destroy()}else x._socket.once("finish",function(){G()}),x.close()},C._read=function(){if(x.isPaused)x.resume()},C._write=function(G,N,J){if(x.readyState===x.CONNECTING){x.once("open",function(){C._write(G,N,J)});return}x.send(G,J)},C.on("end",C9),C.on("error",lg),C}Eg.exports=G9});var bg=w((k6,ng)=>{var{tokenChars:N9}=L1();function J9(x){let g=new Set,$=-1,C=-1,G=0;for(G;G<x.length;G++){let J=x.charCodeAt(G);if(C===-1&&N9[J]===1){if($===-1)$=G}else if(G!==0&&(J===32||J===9)){if(C===-1&&$!==-1)C=G}else if(J===44){if($===-1)throw SyntaxError(`Unexpected character at index ${G}`);if(C===-1)C=G;let I=x.slice($,C);if(g.has(I))throw SyntaxError(`The "${I}" subprotocol is duplicated`);g.add(I),$=C=-1}else throw SyntaxError(`Unexpected character at index ${G}`)}if($===-1||C!==-1)throw SyntaxError("Unexpected end of input");let N=x.slice($,G);if(g.has(N))throw SyntaxError(`The "${N}" subprotocol is duplicated`);return g.add(N),g}ng.exports={parse:J9}});var cg=w((p6,kg)=>{var I9=u("events"),m0=u("http"),{Duplex:c6}=u("stream"),{createHash:Z9}=u("crypto"),dg=Lx(),q1=h1(),Q9=bg(),X9=W0(),{CLOSE_TIMEOUT:z9,GUID:j9,kWebSocket:K9}=N1(),Y9=/^[+/0-9A-Za-z]{22}==$/;class hg extends I9{constructor(x,g){super();if(x={allowSynchronousEvents:!0,autoPong:!0,maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,closeTimeout:z9,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:X9,...x},x.port==null&&!x.server&&!x.noServer||x.port!=null&&(x.server||x.noServer)||x.server&&x.noServer)throw TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(x.port!=null)this._server=m0.createServer(($,C)=>{let G=m0.STATUS_CODES[426];C.writeHead(426,{"Content-Length":G.length,"Content-Type":"text/plain"}),C.end(G)}),this._server.listen(x.port,x.host,x.backlog,g);else if(x.server)this._server=x.server;if(this._server){let $=this.emit.bind(this,"connection");this._removeListeners=H9(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(C,G,N)=>{this.handleUpgrade(C,G,N,$)}})}if(x.perMessageDeflate===!0)x.perMessageDeflate={};if(x.clientTracking)this.clients=new Set,this._shouldEmitClose=!1;this.options=x,this._state=0}address(){if(this.options.noServer)throw Error('The server is operating in "noServer" mode');if(!this._server)return null;return this._server.address()}close(x){if(this._state===2){if(x)this.once("close",()=>{x(Error("The server is not running"))});process.nextTick(o1,this);return}if(x)this.once("close",x);if(this._state===1)return;if(this._state=1,this.options.noServer||this.options.server){if(this._server)this._removeListeners(),this._removeListeners=this._server=null;if(this.clients)if(!this.clients.size)process.nextTick(o1,this);else this._shouldEmitClose=!0;else process.nextTick(o1,this)}else{let g=this._server;this._removeListeners(),this._removeListeners=this._server=null,g.close(()=>{o1(this)})}}shouldHandle(x){if(this.options.path){let g=x.url.indexOf("?");if((g!==-1?x.url.slice(0,g):x.url)!==this.options.path)return!1}return!0}handleUpgrade(x,g,$,C){g.on("error",ig);let G=x.headers["sec-websocket-key"],N=x.headers.upgrade,J=+x.headers["sec-websocket-version"];if(x.method!=="GET"){U1(this,x,g,405,"Invalid HTTP method");return}if(N===void 0||N.toLowerCase()!=="websocket"){U1(this,x,g,400,"Invalid Upgrade header");return}if(G===void 0||!Y9.test(G)){U1(this,x,g,400,"Missing or invalid Sec-WebSocket-Key header");return}if(J!==13&&J!==8){U1(this,x,g,400,"Missing or invalid Sec-WebSocket-Version header",{"Sec-WebSocket-Version":"13, 8"});return}if(!this.shouldHandle(x)){s1(g,400);return}let I=x.headers["sec-websocket-protocol"],Z=new Set;if(I!==void 0)try{Z=Q9.parse(I)}catch(X){U1(this,x,g,400,"Invalid Sec-WebSocket-Protocol header");return}let Q=x.headers["sec-websocket-extensions"],K={};if(this.options.perMessageDeflate&&Q!==void 0){let X=new q1(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let Y=dg.parse(Q);if(Y[q1.extensionName])X.accept(Y[q1.extensionName]),K[q1.extensionName]=X}catch(Y){U1(this,x,g,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let X={origin:x.headers[`${J===8?"sec-websocket-origin":"origin"}`],secure:!!(x.socket.authorized||x.socket.encrypted),req:x};if(this.options.verifyClient.length===2){this.options.verifyClient(X,(Y,M,j,z)=>{if(!Y)return s1(g,M||401,j,z);this.completeUpgrade(K,G,Z,x,g,$,C)});return}if(!this.options.verifyClient(X))return s1(g,401)}this.completeUpgrade(K,G,Z,x,g,$,C)}completeUpgrade(x,g,$,C,G,N,J){if(!G.readable||!G.writable)return G.destroy();if(G[K9])throw Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>0)return s1(G,503);let Z=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${Z9("sha1").update(g+j9).digest("base64")}`],Q=new this.options.WebSocket(null,void 0,this.options);if($.size){let K=this.options.handleProtocols?this.options.handleProtocols($,C):$.values().next().value;if(K)Z.push(`Sec-WebSocket-Protocol: ${K}`),Q._protocol=K}if(x[q1.extensionName]){let K=x[q1.extensionName].params,X=dg.format({[q1.extensionName]:[K]});Z.push(`Sec-WebSocket-Extensions: ${X}`),Q._extensions=x}if(this.emit("headers",Z,C),G.write(Z.concat(`\r
`).join(`\r
`)),G.removeListener("error",ig),Q.setSocket(G,N,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients)this.clients.add(Q),Q.on("close",()=>{if(this.clients.delete(Q),this._shouldEmitClose&&!this.clients.size)process.nextTick(o1,this)});J(Q,C)}}kg.exports=hg;function H9(x,g){for(let $ of Object.keys(g))x.on($,g[$]);return function(){for(let C of Object.keys(g))x.removeListener(C,g[C])}}function o1(x){x._state=2,x.emit("close")}function ig(){this.destroy()}function s1(x,g,$,C){$=$||m0.STATUS_CODES[g],C={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength($),...C},x.once("finish",x.destroy),x.end(`HTTP/1.1 ${g} ${m0.STATUS_CODES[g]}\r
`+Object.keys(C).map((G)=>`${G}: ${C[G]}`).join(`\r
`)+`\r
\r
`+$)}function U1(x,g,$,C,G,N){if(x.listenerCount("wsClientError")){let J=Error(G);Error.captureStackTrace(J,U1),x.emit("wsClientError",J,$,g)}else s1($,C,G,N)}});var N0=s(W1(),1),n=s(n0(),1);import{stdout as c0,stdin as ox}from"node:process";import*as Q1 from"node:readline";import Q4 from"node:readline";import{ReadStream as hx}from"node:tty";var X4=(x)=>x===161||x===164||x===167||x===168||x===170||x===173||x===174||x>=176&&x<=180||x>=182&&x<=186||x>=188&&x<=191||x===198||x===208||x===215||x===216||x>=222&&x<=225||x===230||x>=232&&x<=234||x===236||x===237||x===240||x===242||x===243||x>=247&&x<=250||x===252||x===254||x===257||x===273||x===275||x===283||x===294||x===295||x===299||x>=305&&x<=307||x===312||x>=319&&x<=322||x===324||x>=328&&x<=331||x===333||x===338||x===339||x===358||x===359||x===363||x===462||x===464||x===466||x===468||x===470||x===472||x===474||x===476||x===593||x===609||x===708||x===711||x>=713&&x<=715||x===717||x===720||x>=728&&x<=731||x===733||x===735||x>=768&&x<=879||x>=913&&x<=929||x>=931&&x<=937||x>=945&&x<=961||x>=963&&x<=969||x===1025||x>=1040&&x<=1103||x===1105||x===8208||x>=8211&&x<=8214||x===8216||x===8217||x===8220||x===8221||x>=8224&&x<=8226||x>=8228&&x<=8231||x===8240||x===8242||x===8243||x===8245||x===8251||x===8254||x===8308||x===8319||x>=8321&&x<=8324||x===8364||x===8451||x===8453||x===8457||x===8467||x===8470||x===8481||x===8482||x===8486||x===8491||x===8531||x===8532||x>=8539&&x<=8542||x>=8544&&x<=8555||x>=8560&&x<=8569||x===8585||x>=8592&&x<=8601||x===8632||x===8633||x===8658||x===8660||x===8679||x===8704||x===8706||x===8707||x===8711||x===8712||x===8715||x===8719||x===8721||x===8725||x===8730||x>=8733&&x<=8736||x===8739||x===8741||x>=8743&&x<=8748||x===8750||x>=8756&&x<=8759||x===8764||x===8765||x===8776||x===8780||x===8786||x===8800||x===8801||x>=8804&&x<=8807||x===8810||x===8811||x===8814||x===8815||x===8834||x===8835||x===8838||x===8839||x===8853||x===8857||x===8869||x===8895||x===8978||x>=9312&&x<=9449||x>=9451&&x<=9547||x>=9552&&x<=9587||x>=9600&&x<=9615||x>=9618&&x<=9621||x===9632||x===9633||x>=9635&&x<=9641||x===9650||x===9651||x===9654||x===9655||x===9660||x===9661||x===9664||x===9665||x>=9670&&x<=9672||x===9675||x>=9678&&x<=9681||x>=9698&&x<=9701||x===9711||x===9733||x===9734||x===9737||x===9742||x===9743||x===9756||x===9758||x===9792||x===9794||x===9824||x===9825||x>=9827&&x<=9829||x>=9831&&x<=9834||x===9836||x===9837||x===9839||x===9886||x===9887||x===9919||x>=9926&&x<=9933||x>=9935&&x<=9939||x>=9941&&x<=9953||x===9955||x===9960||x===9961||x>=9963&&x<=9969||x===9972||x>=9974&&x<=9977||x===9979||x===9980||x===9982||x===9983||x===10045||x>=10102&&x<=10111||x>=11094&&x<=11097||x>=12872&&x<=12879||x>=57344&&x<=63743||x>=65024&&x<=65039||x===65533||x>=127232&&x<=127242||x>=127248&&x<=127277||x>=127280&&x<=127337||x>=127344&&x<=127373||x===127375||x===127376||x>=127387&&x<=127404||x>=917760&&x<=917999||x>=983040&&x<=1048573||x>=1048576&&x<=1114109,z4=(x)=>x===12288||x>=65281&&x<=65376||x>=65504&&x<=65510,j4=(x)=>x>=4352&&x<=4447||x===8986||x===8987||x===9001||x===9002||x>=9193&&x<=9196||x===9200||x===9203||x===9725||x===9726||x===9748||x===9749||x>=9800&&x<=9811||x===9855||x===9875||x===9889||x===9898||x===9899||x===9917||x===9918||x===9924||x===9925||x===9934||x===9940||x===9962||x===9970||x===9971||x===9973||x===9978||x===9981||x===9989||x===9994||x===9995||x===10024||x===10060||x===10062||x>=10067&&x<=10069||x===10071||x>=10133&&x<=10135||x===10160||x===10175||x===11035||x===11036||x===11088||x===11093||x>=11904&&x<=11929||x>=11931&&x<=12019||x>=12032&&x<=12245||x>=12272&&x<=12287||x>=12289&&x<=12350||x>=12353&&x<=12438||x>=12441&&x<=12543||x>=12549&&x<=12591||x>=12593&&x<=12686||x>=12688&&x<=12771||x>=12783&&x<=12830||x>=12832&&x<=12871||x>=12880&&x<=19903||x>=19968&&x<=42124||x>=42128&&x<=42182||x>=43360&&x<=43388||x>=44032&&x<=55203||x>=63744&&x<=64255||x>=65040&&x<=65049||x>=65072&&x<=65106||x>=65108&&x<=65126||x>=65128&&x<=65131||x>=94176&&x<=94180||x===94192||x===94193||x>=94208&&x<=100343||x>=100352&&x<=101589||x>=101632&&x<=101640||x>=110576&&x<=110579||x>=110581&&x<=110587||x===110589||x===110590||x>=110592&&x<=110882||x===110898||x>=110928&&x<=110930||x===110933||x>=110948&&x<=110951||x>=110960&&x<=111355||x===126980||x===127183||x===127374||x>=127377&&x<=127386||x>=127488&&x<=127490||x>=127504&&x<=127547||x>=127552&&x<=127560||x===127568||x===127569||x>=127584&&x<=127589||x>=127744&&x<=127776||x>=127789&&x<=127797||x>=127799&&x<=127868||x>=127870&&x<=127891||x>=127904&&x<=127946||x>=127951&&x<=127955||x>=127968&&x<=127984||x===127988||x>=127992&&x<=128062||x===128064||x>=128066&&x<=128252||x>=128255&&x<=128317||x>=128331&&x<=128334||x>=128336&&x<=128359||x===128378||x===128405||x===128406||x===128420||x>=128507&&x<=128591||x>=128640&&x<=128709||x===128716||x>=128720&&x<=128722||x>=128725&&x<=128727||x>=128732&&x<=128735||x===128747||x===128748||x>=128756&&x<=128764||x>=128992&&x<=129003||x===129008||x>=129292&&x<=129338||x>=129340&&x<=129349||x>=129351&&x<=129535||x>=129648&&x<=129660||x>=129664&&x<=129672||x>=129680&&x<=129725||x>=129727&&x<=129733||x>=129742&&x<=129755||x>=129760&&x<=129768||x>=129776&&x<=129784||x>=131072&&x<=196605||x>=196608&&x<=262141,b0=/[\u001b\u009b][[()#;?]*(?:[0-9]{1,4}(?:;[0-9]{0,4})*)?[0-9A-ORZcf-nqry=><]/y,g0=/[\x00-\x08\x0A-\x1F\x7F-\x9F]{1,1000}/y,$0=/\t{1,1000}/y,d0=/[\u{1F1E6}-\u{1F1FF}]{2}|\u{1F3F4}[\u{E0061}-\u{E007A}]{2}[\u{E0030}-\u{E0039}\u{E0061}-\u{E007A}]{1,3}\u{E007F}|(?:\p{Emoji}\uFE0F\u20E3?|\p{Emoji_Modifier_Base}\p{Emoji_Modifier}?|\p{Emoji_Presentation})(?:\u200D(?:\p{Emoji_Modifier_Base}\p{Emoji_Modifier}?|\p{Emoji_Presentation}|\p{Emoji}\uFE0F\u20E3?))*/yu,C0=/(?:[\x20-\x7E\xA0-\xFF](?!\uFE0F)){1,1000}/y,K4=/\p{M}+/gu,Y4={limit:1/0,ellipsis:""},sx=(x,g={},$={})=>{let C=g.limit??1/0,G=g.ellipsis??"",N=g?.ellipsisWidth??(G?sx(G,Y4,$).width:0),J=$.ansiWidth??0,I=$.controlWidth??0,Z=$.tabWidth??8,Q=$.ambiguousWidth??1,K=$.emojiWidth??2,X=$.fullWidthWidth??2,Y=$.regularWidth??1,M=$.wideWidth??2,j=0,z=0,O=x.length,q=0,B=!1,D=O,L=Math.max(0,C-N),A=0,P=0,V=0,R=0;x:for(;;){if(P>A||z>=O&&z>j){let y=x.slice(A,P)||x.slice(j,z);q=0;for(let E of y.replaceAll(K4,"")){let b=E.codePointAt(0)||0;if(z4(b)?R=X:j4(b)?R=M:Q!==Y&&X4(b)?R=Q:R=Y,V+R>L&&(D=Math.min(D,Math.max(A,j)+q)),V+R>C){B=!0;break x}q+=E.length,V+=R}A=P=0}if(z>=O)break;if(C0.lastIndex=z,C0.test(x)){if(q=C0.lastIndex-z,R=q*Y,V+R>L&&(D=Math.min(D,z+Math.floor((L-V)/Y))),V+R>C){B=!0;break}V+=R,A=j,P=z,z=j=C0.lastIndex;continue}if(b0.lastIndex=z,b0.test(x)){if(V+J>L&&(D=Math.min(D,z)),V+J>C){B=!0;break}V+=J,A=j,P=z,z=j=b0.lastIndex;continue}if(g0.lastIndex=z,g0.test(x)){if(q=g0.lastIndex-z,R=q*I,V+R>L&&(D=Math.min(D,z+Math.floor((L-V)/I))),V+R>C){B=!0;break}V+=R,A=j,P=z,z=j=g0.lastIndex;continue}if($0.lastIndex=z,$0.test(x)){if(q=$0.lastIndex-z,R=q*Z,V+R>L&&(D=Math.min(D,z+Math.floor((L-V)/Z))),V+R>C){B=!0;break}V+=R,A=j,P=z,z=j=$0.lastIndex;continue}if(d0.lastIndex=z,d0.test(x)){if(V+K>L&&(D=Math.min(D,z)),V+K>C){B=!0;break}V+=K,A=j,P=z,z=j=d0.lastIndex;continue}z+=1}return{width:B?L:V,index:B?D:O,truncated:B,ellipsed:B&&C>=N}},H4={limit:1/0,ellipsis:"",ellipsisWidth:0},m1=(x,g={})=>sx(x,H4,g).width,J0="\x1B",ax="",M4=39,p0="\x07",rx="[",V4="]",tx="m",o0=`${V4}8;;`,kx=new RegExp(`(?:\\${rx}(?<code>\\d+)m|\\${o0}(?<uri>.*)${p0})`,"y"),O4=(x)=>{if(x>=30&&x<=37||x>=90&&x<=97)return 39;if(x>=40&&x<=47||x>=100&&x<=107)return 49;if(x===1||x===2)return 22;if(x===3)return 23;if(x===4)return 24;if(x===7)return 27;if(x===8)return 28;if(x===9)return 29;if(x===0)return 0},cx=(x)=>`${J0}${rx}${x}${tx}`,px=(x)=>`${J0}${o0}${x}${p0}`,R4=(x)=>x.map((g)=>m1(g)),i0=(x,g,$)=>{let C=g[Symbol.iterator](),G=!1,N=!1,J=x.at(-1),I=J===void 0?0:m1(J),Z=C.next(),Q=C.next(),K=0;for(;!Z.done;){let X=Z.value,Y=m1(X);I+Y<=$?x[x.length-1]+=X:(x.push(X),I=0),(X===J0||X===ax)&&(G=!0,N=g.startsWith(o0,K+1)),G?N?X===p0&&(G=!1,N=!1):X===tx&&(G=!1):(I+=Y,I===$&&!Q.done&&(x.push(""),I=0)),Z=Q,Q=C.next(),K+=X.length}J=x.at(-1),!I&&J!==void 0&&J.length>0&&x.length>1&&(x[x.length-2]+=x.pop())},q4=(x)=>{let g=x.split(" "),$=g.length;for(;$>0&&!(m1(g[$-1])>0);)$--;return $===g.length?x:g.slice(0,$).join(" ")+g.slice($).join("")},U4=(x,g,$={})=>{if($.trim!==!1&&x.trim()==="")return"";let C="",G,N,J=x.split(" "),I=R4(J),Z=[""];for(let[j,z]of J.entries()){$.trim!==!1&&(Z[Z.length-1]=(Z.at(-1)??"").trimStart());let O=m1(Z.at(-1)??"");if(j!==0&&(O>=g&&($.wordWrap===!1||$.trim===!1)&&(Z.push(""),O=0),(O>0||$.trim===!1)&&(Z[Z.length-1]+=" ",O++)),$.hard&&I[j]>g){let q=g-O,B=1+Math.floor((I[j]-q-1)/g);Math.floor((I[j]-1)/g)<B&&Z.push(""),i0(Z,z,g);continue}if(O+I[j]>g&&O>0&&I[j]>0){if($.wordWrap===!1&&O<g){i0(Z,z,g);continue}Z.push("")}if(O+I[j]>g&&$.wordWrap===!1){i0(Z,z,g);continue}Z[Z.length-1]+=z}$.trim!==!1&&(Z=Z.map((j)=>q4(j)));let Q=Z.join(`
`),K=Q[Symbol.iterator](),X=K.next(),Y=K.next(),M=0;for(;!X.done;){let j=X.value,z=Y.value;if(C+=j,j===J0||j===ax){kx.lastIndex=M+1;let q=kx.exec(Q)?.groups;if(q?.code!==void 0){let B=Number.parseFloat(q.code);G=B===M4?void 0:B}else q?.uri!==void 0&&(N=q.uri.length===0?void 0:q.uri)}let O=G?O4(G):void 0;z===`
`?(N&&(C+=px("")),G&&O&&(C+=cx(O))):j===`
`&&(G&&O&&(C+=cx(G)),N&&(C+=px(N))),M+=j.length,X=Y,Y=K.next()}return C};function h0(x,g,$){return String(x).normalize().replaceAll(`\r
`,`
`).split(`
`).map((C)=>U4(C,g,$)).join(`
`)}var B4=["up","down","left","right","space","enter","cancel"],e={actions:new Set(B4),aliases:new Map([["k","up"],["j","down"],["h","left"],["l","right"],["\x03","cancel"],["escape","cancel"]]),messages:{cancel:"Canceled",error:"Something went wrong"},withGuide:!0};function s0(x,g){if(typeof x=="string")return e.aliases.get(x)===g;for(let $ of x)if($!==void 0&&s0($,g))return!0;return!1}function D4(x,g){if(x===g)return;let $=x.split(`
`),C=g.split(`
`),G=Math.max($.length,C.length),N=[];for(let J=0;J<G;J++)$[J]!==C[J]&&N.push(J);return{lines:N,numLinesBefore:$.length,numLinesAfter:C.length,numLines:G}}var A4=globalThis.process.platform.startsWith("win"),k0=Symbol("clack:cancel");function v1(x){return x===k0}function G0(x,g){let $=x;$.isTTY&&$.setRawMode(g)}function ex({input:x=ox,output:g=c0,overwrite:$=!0,hideCursor:C=!0}={}){let G=Q1.createInterface({input:x,output:g,prompt:"",tabSize:1});Q1.emitKeypressEvents(x,G),x instanceof hx&&x.isTTY&&x.setRawMode(!0);let N=(J,{name:I,sequence:Z})=>{let Q=String(J);if(s0([Q,I,Z],"cancel")){C&&g.write(n.cursor.show),process.exit(0);return}if(!$)return;Q1.moveCursor(g,I==="return"?0:-1,I==="return"?-1:0,()=>{Q1.clearLine(g,1,()=>{x.once("keypress",N)})})};return C&&g.write(n.cursor.hide),x.once("keypress",N),()=>{x.off("keypress",N),C&&g.write(n.cursor.show),x instanceof hx&&x.isTTY&&!A4&&x.setRawMode(!1),G.terminal=!1,G.close()}}var y1=(x)=>("columns"in x)&&typeof x.columns=="number"?x.columns:80,a0=(x)=>("rows"in x)&&typeof x.rows=="number"?x.rows:20;function M1(x,g,$,C=$){let G=y1(x??c0);return h0(g,G-$.length,{hard:!0,trim:!1}).split(`
`).map((N,J)=>`${J===0?C:$}${N}`).join(`
`)}class u1{input;output;_abortSignal;rl;opts;_render;_track=!1;_prevFrame="";_subscribers=new Map;_cursor=0;state="initial";error="";value;userInput="";constructor(x,g=!0){let{input:$=ox,output:C=c0,render:G,signal:N,...J}=x;this.opts=J,this.onKeypress=this.onKeypress.bind(this),this.close=this.close.bind(this),this.render=this.render.bind(this),this._render=G.bind(this),this._track=g,this._abortSignal=N,this.input=$,this.output=C}unsubscribe(){this._subscribers.clear()}setSubscriber(x,g){let $=this._subscribers.get(x)??[];$.push(g),this._subscribers.set(x,$)}on(x,g){this.setSubscriber(x,{cb:g})}once(x,g){this.setSubscriber(x,{cb:g,once:!0})}emit(x,...g){let $=this._subscribers.get(x)??[],C=[];for(let G of $)G.cb(...g),G.once&&C.push(()=>$.splice($.indexOf(G),1));for(let G of C)G()}prompt(){return new Promise((x)=>{if(this._abortSignal){if(this._abortSignal.aborted)return this.state="cancel",this.close(),x(k0);this._abortSignal.addEventListener("abort",()=>{this.state="cancel",this.close()},{once:!0})}this.rl=Q4.createInterface({input:this.input,tabSize:2,prompt:"",escapeCodeTimeout:50,terminal:!0}),this.rl.prompt(),this.opts.initialUserInput!==void 0&&this._setUserInput(this.opts.initialUserInput,!0),this.input.on("keypress",this.onKeypress),G0(this.input,!0),this.output.on("resize",this.render),this.render(),this.once("submit",()=>{this.output.write(n.cursor.show),this.output.off("resize",this.render),G0(this.input,!1),x(this.value)}),this.once("cancel",()=>{this.output.write(n.cursor.show),this.output.off("resize",this.render),G0(this.input,!1),x(k0)})})}_isActionKey(x,g){return x==="\t"}_setValue(x){this.value=x,this.emit("value",this.value)}_setUserInput(x,g){this.userInput=x??"",this.emit("userInput",this.userInput),g&&this._track&&this.rl&&(this.rl.write(this.userInput),this._cursor=this.rl.cursor)}_clearUserInput(){this.rl?.write(null,{ctrl:!0,name:"u"}),this._setUserInput("")}onKeypress(x,g){if(this._track&&g.name!=="return"&&(g.name&&this._isActionKey(x,g)&&this.rl?.write(null,{ctrl:!0,name:"h"}),this._cursor=this.rl?.cursor??0,this._setUserInput(this.rl?.line)),this.state==="error"&&(this.state="active"),g?.name&&(!this._track&&e.aliases.has(g.name)&&this.emit("cursor",e.aliases.get(g.name)),e.actions.has(g.name)&&this.emit("cursor",g.name)),x&&(x.toLowerCase()==="y"||x.toLowerCase()==="n")&&this.emit("confirm",x.toLowerCase()==="y"),this.emit("key",x?.toLowerCase(),g),g?.name==="return"){if(this.opts.validate){let $=this.opts.validate(this.value);$&&(this.error=$ instanceof Error?$.message:$,this.state="error",this.rl?.write(this.userInput))}this.state!=="error"&&(this.state="submit")}s0([x,g?.name,g?.sequence],"cancel")&&(this.state="cancel"),(this.state==="submit"||this.state==="cancel")&&this.emit("finalize"),this.render(),(this.state==="submit"||this.state==="cancel")&&this.close()}close(){this.input.unpipe(),this.input.removeListener("keypress",this.onKeypress),this.output.write(`
`),G0(this.input,!1),this.rl?.close(),this.rl=void 0,this.emit(`${this.state}`,this.value),this.unsubscribe()}restoreCursor(){let x=h0(this._prevFrame,process.stdout.columns,{hard:!0,trim:!1}).split(`
`).length-1;this.output.write(n.cursor.move(-999,x*-1))}render(){let x=h0(this._render(this)??"",process.stdout.columns,{hard:!0,trim:!1});if(x!==this._prevFrame){if(this.state==="initial")this.output.write(n.cursor.hide);else{let g=D4(this._prevFrame,x),$=a0(this.output);if(this.restoreCursor(),g){let C=Math.max(0,g.numLinesAfter-$),G=Math.max(0,g.numLinesBefore-$),N=g.lines.find((J)=>J>=C);if(N===void 0){this._prevFrame=x;return}if(g.lines.length===1){this.output.write(n.cursor.move(0,N-G)),this.output.write(n.erase.lines(1));let J=x.split(`
`);this.output.write(J[N]),this._prevFrame=x,this.output.write(n.cursor.move(0,J.length-N-1));return}else if(g.lines.length>1){if(C<G)N=C;else{let I=N-G;I>0&&this.output.write(n.cursor.move(0,I))}this.output.write(n.erase.down());let J=x.split(`
`).slice(N);this.output.write(J.join(`
`)),this._prevFrame=x;return}}this.output.write(n.erase.down())}this.output.write(x),this.state==="initial"&&(this.state="active"),this._prevFrame=x}}}function T4(x,g){if(x===void 0||g.length===0)return 0;let $=g.findIndex((C)=>C.value===x);return $!==-1?$:0}function L4(x,g){return(g.label??String(g.value)).toLowerCase().includes(x.toLowerCase())}function _4(x,g){if(g)return x?g:g[0]}class x2 extends u1{filteredOptions;multiple;isNavigating=!1;selectedValues=[];focusedValue;#x=0;#$="";#C;#g;get cursor(){return this.#x}get userInputWithCursor(){if(!this.userInput)return N0.default.inverse(N0.default.hidden("_"));if(this._cursor>=this.userInput.length)return`${this.userInput}`;let x=this.userInput.slice(0,this._cursor),[g,...$]=this.userInput.slice(this._cursor);return`${x}${N0.default.inverse(g)}${$.join("")}`}get options(){return typeof this.#g=="function"?this.#g():this.#g}constructor(x){super(x),this.#g=x.options;let g=this.options;this.filteredOptions=[...g],this.multiple=x.multiple===!0,this.#C=x.filter??L4;let $;if(x.initialValue&&Array.isArray(x.initialValue)?this.multiple?$=x.initialValue:$=x.initialValue.slice(0,1):!this.multiple&&this.options.length>0&&($=[this.options[0].value]),$)for(let C of $){let G=g.findIndex((N)=>N.value===C);G!==-1&&(this.toggleSelected(C),this.#x=G)}this.focusedValue=this.options[this.#x]?.value,this.on("key",(C,G)=>this.#G(C,G)),this.on("userInput",(C)=>this.#N(C))}_isActionKey(x,g){return x==="\t"||this.multiple&&this.isNavigating&&g.name==="space"&&x!==void 0&&x!==""}#G(x,g){let $=g.name==="up",C=g.name==="down",G=g.name==="return";$||C?(this.#x=Math.max(0,Math.min(this.#x+($?-1:1),this.filteredOptions.length-1)),this.focusedValue=this.filteredOptions[this.#x]?.value,this.multiple||(this.selectedValues=[this.focusedValue]),this.isNavigating=!0):G?this.value=_4(this.multiple,this.selectedValues):this.multiple?this.focusedValue!==void 0&&(g.name==="tab"||this.isNavigating&&g.name==="space")?this.toggleSelected(this.focusedValue):this.isNavigating=!1:(this.focusedValue&&(this.selectedValues=[this.focusedValue]),this.isNavigating=!1)}deselectAll(){this.selectedValues=[]}toggleSelected(x){this.filteredOptions.length!==0&&(this.multiple?this.selectedValues.includes(x)?this.selectedValues=this.selectedValues.filter((g)=>g!==x):this.selectedValues=[...this.selectedValues,x]:this.selectedValues=[x])}#N(x){if(x!==this.#$){this.#$=x;let g=this.options;x?this.filteredOptions=g.filter(($)=>this.#C(x,$)):this.filteredOptions=[...g],this.#x=T4(this.focusedValue,this.filteredOptions),this.focusedValue=this.filteredOptions[this.#x]?.value,this.multiple||(this.focusedValue!==void 0?this.toggleSelected(this.focusedValue):this.deselectAll())}}}class g2 extends u1{options;cursor=0;#x;getGroupItems(x){return this.options.filter((g)=>g.group===x)}isGroupSelected(x){let g=this.getGroupItems(x),$=this.value;return $===void 0?!1:g.every((C)=>$.includes(C.value))}toggleValue(){let x=this.options[this.cursor];if(this.value===void 0&&(this.value=[]),x.group===!0){let g=x.value,$=this.getGroupItems(g);this.isGroupSelected(g)?this.value=this.value.filter((C)=>$.findIndex((G)=>G.value===C)===-1):this.value=[...this.value,...$.map((C)=>C.value)],this.value=Array.from(new Set(this.value))}else{let g=this.value.includes(x.value);this.value=g?this.value.filter(($)=>$!==x.value):[...this.value,x.value]}}constructor(x){super(x,!1);let{options:g}=x;this.#x=x.selectableGroups!==!1,this.options=Object.entries(g).flatMap(([$,C])=>[{value:$,group:!0,label:$},...C.map((G)=>({...G,group:$}))]),this.value=[...x.initialValues??[]],this.cursor=Math.max(this.options.findIndex(({value:$})=>$===x.cursorAt),this.#x?0:1),this.on("cursor",($)=>{switch($){case"left":case"up":{this.cursor=this.cursor===0?this.options.length-1:this.cursor-1;let C=this.options[this.cursor]?.group===!0;!this.#x&&C&&(this.cursor=this.cursor===0?this.options.length-1:this.cursor-1);break}case"down":case"right":{this.cursor=this.cursor===this.options.length-1?0:this.cursor+1;let C=this.options[this.cursor]?.group===!0;!this.#x&&C&&(this.cursor=this.cursor===this.options.length-1?0:this.cursor+1);break}case"space":this.toggleValue();break}})}}function H1(x,g,$){let C=x+g,G=Math.max($.length-1,0),N=C<0?G:C>G?0:C;return $[N].disabled?H1(N,g<0?-1:1,$):N}class r0 extends u1{options;cursor=0;get _value(){return this.options[this.cursor].value}get _enabledOptions(){return this.options.filter((x)=>x.disabled!==!0)}toggleAll(){let x=this._enabledOptions,g=this.value!==void 0&&this.value.length===x.length;this.value=g?[]:x.map(($)=>$.value)}toggleInvert(){let x=this.value;if(!x)return;let g=this._enabledOptions.filter(($)=>!x.includes($.value));this.value=g.map(($)=>$.value)}toggleValue(){this.value===void 0&&(this.value=[]);let x=this.value.includes(this._value);this.value=x?this.value.filter((g)=>g!==this._value):[...this.value,this._value]}constructor(x){super(x,!1),this.options=x.options,this.value=[...x.initialValues??[]];let g=Math.max(this.options.findIndex(({value:$})=>$===x.cursorAt),0);this.cursor=this.options[g].disabled?H1(g,1,this.options):g,this.on("key",($)=>{$==="a"&&this.toggleAll(),$==="i"&&this.toggleInvert()}),this.on("cursor",($)=>{switch($){case"left":case"up":this.cursor=H1(this.cursor,-1,this.options);break;case"down":case"right":this.cursor=H1(this.cursor,1,this.options);break;case"space":this.toggleValue();break}})}}class t0 extends u1{options;cursor=0;get _selectedValue(){return this.options[this.cursor]}changeValue(){this.value=this._selectedValue.value}constructor(x){super(x,!1),this.options=x.options;let g=this.options.findIndex(({value:C})=>C===x.initialValue),$=g===-1?0:g;this.cursor=this.options[$].disabled?H1($,1,this.options):$,this.changeValue(),this.on("cursor",(C)=>{switch(C){case"left":case"up":this.cursor=H1(this.cursor,-1,this.options);break;case"down":case"right":this.cursor=H1(this.cursor,1,this.options);break}this.changeValue()})}}var H=s(W1(),1);import c from"node:process";var l1=s(n0(),1);function P4(){return c.platform!=="win32"?c.env.TERM!=="linux":!!c.env.CI||!!c.env.WT_SESSION||!!c.env.TERMINUS_SUBLIME||c.env.ConEmuTask==="{cmd::Cmder}"||c.env.TERM_PROGRAM==="Terminus-Sublime"||c.env.TERM_PROGRAM==="vscode"||c.env.TERM==="xterm-256color"||c.env.TERM==="alacritty"||c.env.TERMINAL_EMULATOR==="JetBrains-JediTerm"}var $x=P4(),F4=()=>process.env.CI==="true";var F=(x,g)=>$x?x:g,S4=F("","*"),Q2=F("","x"),X2=F("","x"),z0=F("","o"),W4=F("","T"),m=F("","|"),E1=F("",""),Z6=F("","T"),Q6=F("",""),m4=F("",">"),$2=F(""," "),v4=F("","[]"),C2=F("","[+]"),G2=F("","[ ]"),X6=F("",""),N2=F("","-"),y4=F("","+"),u4=F("","+"),f4=F("","+"),l4=F("","+"),z6=F("","+"),E4=F("",""),w4=F("","*"),n4=F("","!"),b4=F("","x"),z2=(x)=>{switch(x){case"initial":case"active":return H.default.cyan(S4);case"cancel":return H.default.red(Q2);case"error":return H.default.yellow(X2);case"submit":return H.default.green(z0)}},j2=(x)=>{switch(x){case"initial":case"active":return H.default.cyan(m);case"cancel":return H.default.red(m);case"error":return H.default.yellow(m);case"submit":return H.default.green(m)}},d4=(x)=>x===161||x===164||x===167||x===168||x===170||x===173||x===174||x>=176&&x<=180||x>=182&&x<=186||x>=188&&x<=191||x===198||x===208||x===215||x===216||x>=222&&x<=225||x===230||x>=232&&x<=234||x===236||x===237||x===240||x===242||x===243||x>=247&&x<=250||x===252||x===254||x===257||x===273||x===275||x===283||x===294||x===295||x===299||x>=305&&x<=307||x===312||x>=319&&x<=322||x===324||x>=328&&x<=331||x===333||x===338||x===339||x===358||x===359||x===363||x===462||x===464||x===466||x===468||x===470||x===472||x===474||x===476||x===593||x===609||x===708||x===711||x>=713&&x<=715||x===717||x===720||x>=728&&x<=731||x===733||x===735||x>=768&&x<=879||x>=913&&x<=929||x>=931&&x<=937||x>=945&&x<=961||x>=963&&x<=969||x===1025||x>=1040&&x<=1103||x===1105||x===8208||x>=8211&&x<=8214||x===8216||x===8217||x===8220||x===8221||x>=8224&&x<=8226||x>=8228&&x<=8231||x===8240||x===8242||x===8243||x===8245||x===8251||x===8254||x===8308||x===8319||x>=8321&&x<=8324||x===8364||x===8451||x===8453||x===8457||x===8467||x===8470||x===8481||x===8482||x===8486||x===8491||x===8531||x===8532||x>=8539&&x<=8542||x>=8544&&x<=8555||x>=8560&&x<=8569||x===8585||x>=8592&&x<=8601||x===8632||x===8633||x===8658||x===8660||x===8679||x===8704||x===8706||x===8707||x===8711||x===8712||x===8715||x===8719||x===8721||x===8725||x===8730||x>=8733&&x<=8736||x===8739||x===8741||x>=8743&&x<=8748||x===8750||x>=8756&&x<=8759||x===8764||x===8765||x===8776||x===8780||x===8786||x===8800||x===8801||x>=8804&&x<=8807||x===8810||x===8811||x===8814||x===8815||x===8834||x===8835||x===8838||x===8839||x===8853||x===8857||x===8869||x===8895||x===8978||x>=9312&&x<=9449||x>=9451&&x<=9547||x>=9552&&x<=9587||x>=9600&&x<=9615||x>=9618&&x<=9621||x===9632||x===9633||x>=9635&&x<=9641||x===9650||x===9651||x===9654||x===9655||x===9660||x===9661||x===9664||x===9665||x>=9670&&x<=9672||x===9675||x>=9678&&x<=9681||x>=9698&&x<=9701||x===9711||x===9733||x===9734||x===9737||x===9742||x===9743||x===9756||x===9758||x===9792||x===9794||x===9824||x===9825||x>=9827&&x<=9829||x>=9831&&x<=9834||x===9836||x===9837||x===9839||x===9886||x===9887||x===9919||x>=9926&&x<=9933||x>=9935&&x<=9939||x>=9941&&x<=9953||x===9955||x===9960||x===9961||x>=9963&&x<=9969||x===9972||x>=9974&&x<=9977||x===9979||x===9980||x===9982||x===9983||x===10045||x>=10102&&x<=10111||x>=11094&&x<=11097||x>=12872&&x<=12879||x>=57344&&x<=63743||x>=65024&&x<=65039||x===65533||x>=127232&&x<=127242||x>=127248&&x<=127277||x>=127280&&x<=127337||x>=127344&&x<=127373||x===127375||x===127376||x>=127387&&x<=127404||x>=917760&&x<=917999||x>=983040&&x<=1048573||x>=1048576&&x<=1114109,i4=(x)=>x===12288||x>=65281&&x<=65376||x>=65504&&x<=65510,h4=(x)=>x>=4352&&x<=4447||x===8986||x===8987||x===9001||x===9002||x>=9193&&x<=9196||x===9200||x===9203||x===9725||x===9726||x===9748||x===9749||x>=9800&&x<=9811||x===9855||x===9875||x===9889||x===9898||x===9899||x===9917||x===9918||x===9924||x===9925||x===9934||x===9940||x===9962||x===9970||x===9971||x===9973||x===9978||x===9981||x===9989||x===9994||x===9995||x===10024||x===10060||x===10062||x>=10067&&x<=10069||x===10071||x>=10133&&x<=10135||x===10160||x===10175||x===11035||x===11036||x===11088||x===11093||x>=11904&&x<=11929||x>=11931&&x<=12019||x>=12032&&x<=12245||x>=12272&&x<=12287||x>=12289&&x<=12350||x>=12353&&x<=12438||x>=12441&&x<=12543||x>=12549&&x<=12591||x>=12593&&x<=12686||x>=12688&&x<=12771||x>=12783&&x<=12830||x>=12832&&x<=12871||x>=12880&&x<=19903||x>=19968&&x<=42124||x>=42128&&x<=42182||x>=43360&&x<=43388||x>=44032&&x<=55203||x>=63744&&x<=64255||x>=65040&&x<=65049||x>=65072&&x<=65106||x>=65108&&x<=65126||x>=65128&&x<=65131||x>=94176&&x<=94180||x===94192||x===94193||x>=94208&&x<=100343||x>=100352&&x<=101589||x>=101632&&x<=101640||x>=110576&&x<=110579||x>=110581&&x<=110587||x===110589||x===110590||x>=110592&&x<=110882||x===110898||x>=110928&&x<=110930||x===110933||x>=110948&&x<=110951||x>=110960&&x<=111355||x===126980||x===127183||x===127374||x>=127377&&x<=127386||x>=127488&&x<=127490||x>=127504&&x<=127547||x>=127552&&x<=127560||x===127568||x===127569||x>=127584&&x<=127589||x>=127744&&x<=127776||x>=127789&&x<=127797||x>=127799&&x<=127868||x>=127870&&x<=127891||x>=127904&&x<=127946||x>=127951&&x<=127955||x>=127968&&x<=127984||x===127988||x>=127992&&x<=128062||x===128064||x>=128066&&x<=128252||x>=128255&&x<=128317||x>=128331&&x<=128334||x>=128336&&x<=128359||x===128378||x===128405||x===128406||x===128420||x>=128507&&x<=128591||x>=128640&&x<=128709||x===128716||x>=128720&&x<=128722||x>=128725&&x<=128727||x>=128732&&x<=128735||x===128747||x===128748||x>=128756&&x<=128764||x>=128992&&x<=129003||x===129008||x>=129292&&x<=129338||x>=129340&&x<=129349||x>=129351&&x<=129535||x>=129648&&x<=129660||x>=129664&&x<=129672||x>=129680&&x<=129725||x>=129727&&x<=129733||x>=129742&&x<=129755||x>=129760&&x<=129768||x>=129776&&x<=129784||x>=131072&&x<=196605||x>=196608&&x<=262141,e0=/[\u001b\u009b][[()#;?]*(?:[0-9]{1,4}(?:;[0-9]{0,4})*)?[0-9A-ORZcf-nqry=><]/y,I0=/[\x00-\x08\x0A-\x1F\x7F-\x9F]{1,1000}/y,Z0=/\t{1,1000}/y,xx=/[\u{1F1E6}-\u{1F1FF}]{2}|\u{1F3F4}[\u{E0061}-\u{E007A}]{2}[\u{E0030}-\u{E0039}\u{E0061}-\u{E007A}]{1,3}\u{E007F}|(?:\p{Emoji}\uFE0F\u20E3?|\p{Emoji_Modifier_Base}\p{Emoji_Modifier}?|\p{Emoji_Presentation})(?:\u200D(?:\p{Emoji_Modifier_Base}\p{Emoji_Modifier}?|\p{Emoji_Presentation}|\p{Emoji}\uFE0F\u20E3?))*/yu,Q0=/(?:[\x20-\x7E\xA0-\xFF](?!\uFE0F)){1,1000}/y,k4=/\p{M}+/gu,c4={limit:1/0,ellipsis:""},K2=(x,g={},$={})=>{let C=g.limit??1/0,G=g.ellipsis??"",N=g?.ellipsisWidth??(G?K2(G,c4,$).width:0),J=$.ansiWidth??0,I=$.controlWidth??0,Z=$.tabWidth??8,Q=$.ambiguousWidth??1,K=$.emojiWidth??2,X=$.fullWidthWidth??2,Y=$.regularWidth??1,M=$.wideWidth??2,j=0,z=0,O=x.length,q=0,B=!1,D=O,L=Math.max(0,C-N),A=0,P=0,V=0,R=0;x:for(;;){if(P>A||z>=O&&z>j){let y=x.slice(A,P)||x.slice(j,z);q=0;for(let E of y.replaceAll(k4,"")){let b=E.codePointAt(0)||0;if(i4(b)?R=X:h4(b)?R=M:Q!==Y&&d4(b)?R=Q:R=Y,V+R>L&&(D=Math.min(D,Math.max(A,j)+q)),V+R>C){B=!0;break x}q+=E.length,V+=R}A=P=0}if(z>=O)break;if(Q0.lastIndex=z,Q0.test(x)){if(q=Q0.lastIndex-z,R=q*Y,V+R>L&&(D=Math.min(D,z+Math.floor((L-V)/Y))),V+R>C){B=!0;break}V+=R,A=j,P=z,z=j=Q0.lastIndex;continue}if(e0.lastIndex=z,e0.test(x)){if(V+J>L&&(D=Math.min(D,z)),V+J>C){B=!0;break}V+=J,A=j,P=z,z=j=e0.lastIndex;continue}if(I0.lastIndex=z,I0.test(x)){if(q=I0.lastIndex-z,R=q*I,V+R>L&&(D=Math.min(D,z+Math.floor((L-V)/I))),V+R>C){B=!0;break}V+=R,A=j,P=z,z=j=I0.lastIndex;continue}if(Z0.lastIndex=z,Z0.test(x)){if(q=Z0.lastIndex-z,R=q*Z,V+R>L&&(D=Math.min(D,z+Math.floor((L-V)/Z))),V+R>C){B=!0;break}V+=R,A=j,P=z,z=j=Z0.lastIndex;continue}if(xx.lastIndex=z,xx.test(x)){if(V+K>L&&(D=Math.min(D,z)),V+K>C){B=!0;break}V+=K,A=j,P=z,z=j=xx.lastIndex;continue}z+=1}return{width:B?L:V,index:B?D:O,truncated:B,ellipsed:B&&C>=N}},p4={limit:1/0,ellipsis:"",ellipsisWidth:0},g1=(x,g={})=>K2(x,p4,g).width,j0="\x1B",Y2="",o4=39,Gx="\x07",H2="[",s4="]",M2="m",Nx=`${s4}8;;`,J2=new RegExp(`(?:\\${H2}(?<code>\\d+)m|\\${Nx}(?<uri>.*)${Gx})`,"y"),a4=(x)=>{if(x>=30&&x<=37||x>=90&&x<=97)return 39;if(x>=40&&x<=47||x>=100&&x<=107)return 49;if(x===1||x===2)return 22;if(x===3)return 23;if(x===4)return 24;if(x===7)return 27;if(x===8)return 28;if(x===9)return 29;if(x===0)return 0},I2=(x)=>`${j0}${H2}${x}${M2}`,Z2=(x)=>`${j0}${Nx}${x}${Gx}`,r4=(x)=>x.map((g)=>g1(g)),gx=(x,g,$)=>{let C=g[Symbol.iterator](),G=!1,N=!1,J=x.at(-1),I=J===void 0?0:g1(J),Z=C.next(),Q=C.next(),K=0;for(;!Z.done;){let X=Z.value,Y=g1(X);I+Y<=$?x[x.length-1]+=X:(x.push(X),I=0),(X===j0||X===Y2)&&(G=!0,N=g.startsWith(Nx,K+1)),G?N?X===Gx&&(G=!1,N=!1):X===M2&&(G=!1):(I+=Y,I===$&&!Q.done&&(x.push(""),I=0)),Z=Q,Q=C.next(),K+=X.length}J=x.at(-1),!I&&J!==void 0&&J.length>0&&x.length>1&&(x[x.length-2]+=x.pop())},t4=(x)=>{let g=x.split(" "),$=g.length;for(;$>0&&!(g1(g[$-1])>0);)$--;return $===g.length?x:g.slice(0,$).join(" ")+g.slice($).join("")},e4=(x,g,$={})=>{if($.trim!==!1&&x.trim()==="")return"";let C="",G,N,J=x.split(" "),I=r4(J),Z=[""];for(let[j,z]of J.entries()){$.trim!==!1&&(Z[Z.length-1]=(Z.at(-1)??"").trimStart());let O=g1(Z.at(-1)??"");if(j!==0&&(O>=g&&($.wordWrap===!1||$.trim===!1)&&(Z.push(""),O=0),(O>0||$.trim===!1)&&(Z[Z.length-1]+=" ",O++)),$.hard&&I[j]>g){let q=g-O,B=1+Math.floor((I[j]-q-1)/g);Math.floor((I[j]-1)/g)<B&&Z.push(""),gx(Z,z,g);continue}if(O+I[j]>g&&O>0&&I[j]>0){if($.wordWrap===!1&&O<g){gx(Z,z,g);continue}Z.push("")}if(O+I[j]>g&&$.wordWrap===!1){gx(Z,z,g);continue}Z[Z.length-1]+=z}$.trim!==!1&&(Z=Z.map((j)=>t4(j)));let Q=Z.join(`
`),K=Q[Symbol.iterator](),X=K.next(),Y=K.next(),M=0;for(;!X.done;){let j=X.value,z=Y.value;if(C+=j,j===j0||j===Y2){J2.lastIndex=M+1;let q=J2.exec(Q)?.groups;if(q?.code!==void 0){let B=Number.parseFloat(q.code);G=B===o4?void 0:B}else q?.uri!==void 0&&(N=q.uri.length===0?void 0:q.uri)}let O=G?a4(G):void 0;z===`
`?(N&&(C+=Z2("")),G&&O&&(C+=I2(O))):j===`
`&&(G&&O&&(C+=I2(G)),N&&(C+=Z2(N))),M+=j.length,X=Y,Y=K.next()}return C};function w1(x,g,$){return String(x).normalize().replaceAll(`\r
`,`
`).split(`
`).map((C)=>e4(C,g,$)).join(`
`)}var x3=(x,g,$,C,G)=>{let N=g,J=0;for(let I=$;I<C;I++){let Z=x[I];if(N=N-Z.length,J++,N<=G)break}return{lineCount:N,removals:J}},Cx=(x)=>{let{cursor:g,options:$,style:C}=x,G=x.output??process.stdout,N=y1(G),J=x.columnPadding??0,I=x.rowPadding??4,Z=N-J,Q=a0(G),K=H.default.dim("..."),X=x.maxItems??Number.POSITIVE_INFINITY,Y=Math.max(Q-I,0),M=Math.max(Math.min(X,Y),5),j=0;g>=M-3&&(j=Math.max(Math.min(g-M+3,$.length-M),0));let z=M<$.length&&j>0,O=M<$.length&&j+M<$.length,q=Math.min(j+M,$.length),B=[],D=0;z&&D++,O&&D++;let L=j+(z?1:0),A=q-(O?1:0);for(let V=L;V<A;V++){let R=w1(C($[V],V===g),Z,{hard:!0,trim:!1}).split(`
`);B.push(R),D+=R.length}if(D>Y){let V=0,R=0,y=D,E=g-L,b=(Y1,W)=>x3(B,y,Y1,W,Y);z?({lineCount:y,removals:V}=b(0,E),y>Y&&({lineCount:y,removals:R}=b(E+1,B.length))):({lineCount:y,removals:R}=b(E+1,B.length),y>Y&&({lineCount:y,removals:V}=b(0,E))),V>0&&(z=!0,B.splice(0,V)),R>0&&(O=!0,B.splice(B.length-R,R))}let P=[];z&&P.push(K);for(let V of B)for(let R of V)P.push(R);return O&&P.push(K),P};var x1={message:(x=[],{symbol:g=H.default.gray(m),secondarySymbol:$=H.default.gray(m),output:C=process.stdout,spacing:G=1,withGuide:N}={})=>{let J=[],I=(N??e.withGuide)!==!1,Z=I?$:"",Q=I?`${g}  `:"",K=I?`${$}  `:"";for(let Y=0;Y<G;Y++)J.push(Z);let X=Array.isArray(x)?x:x.split(`
`);if(X.length>0){let[Y,...M]=X;Y.length>0?J.push(`${Q}${Y}`):J.push(I?g:"");for(let j of M)j.length>0?J.push(`${K}${j}`):J.push(I?$:"")}C.write(`${J.join(`
`)}
`)},info:(x,g)=>{x1.message(x,{...g,symbol:H.default.blue(E4)})},success:(x,g)=>{x1.message(x,{...g,symbol:H.default.green(w4)})},step:(x,g)=>{x1.message(x,{...g,symbol:H.default.green(z0)})},warn:(x,g)=>{x1.message(x,{...g,symbol:H.default.yellow(n4)})},warning:(x,g)=>{x1.warn(x,g)},error:(x,g)=>{x1.message(x,{...g,symbol:H.default.red(b4)})}},Jx=(x="",g)=>{(g?.output??process.stdout).write(`${H.default.gray(E1)}  ${H.default.red(x)}

`)},K0=(x="",g)=>{(g?.output??process.stdout).write(`${H.default.gray(W4)}  ${x}
`)},B1=(x="",g)=>{(g?.output??process.stdout).write(`${H.default.gray(m)}
${H.default.gray(E1)}  ${x}

`)},f1=(x,g)=>x.split(`
`).map(($)=>g($)).join(`
`),V2=(x)=>{let g=(C,G)=>{let N=C.label??String(C.value);return G==="disabled"?`${H.default.gray(G2)} ${f1(N,(J)=>H.default.strikethrough(H.default.gray(J)))}${C.hint?` ${H.default.dim(`(${C.hint??"disabled"})`)}`:""}`:G==="active"?`${H.default.cyan(v4)} ${N}${C.hint?` ${H.default.dim(`(${C.hint})`)}`:""}`:G==="selected"?`${H.default.green(C2)} ${f1(N,H.default.dim)}${C.hint?` ${H.default.dim(`(${C.hint})`)}`:""}`:G==="cancelled"?`${f1(N,(J)=>H.default.strikethrough(H.default.dim(J)))}`:G==="active-selected"?`${H.default.green(C2)} ${N}${C.hint?` ${H.default.dim(`(${C.hint})`)}`:""}`:G==="submitted"?`${f1(N,H.default.dim)}`:`${H.default.dim(G2)} ${f1(N,H.default.dim)}`},$=x.required??!0;return new r0({options:x.options,signal:x.signal,input:x.input,output:x.output,initialValues:x.initialValues,required:$,cursorAt:x.cursorAt,validate(C){if($&&(C===void 0||C.length===0))return`Please select at least one option.
${H.default.reset(H.default.dim(`Press ${H.default.gray(H.default.bgWhite(H.default.inverse(" space ")))} to select, ${H.default.gray(H.default.bgWhite(H.default.inverse(" enter ")))} to submit`))}`},render(){let C=M1(x.output,x.message,`${j2(this.state)}  `,`${z2(this.state)}  `),G=`${H.default.gray(m)}
${C}
`,N=this.value??[],J=(I,Z)=>{if(I.disabled)return g(I,"disabled");let Q=N.includes(I.value);return Z&&Q?g(I,"active-selected"):Q?g(I,"selected"):g(I,Z?"active":"inactive")};switch(this.state){case"submit":{let I=this.options.filter(({value:Q})=>N.includes(Q)).map((Q)=>g(Q,"submitted")).join(H.default.dim(", "))||H.default.dim("none"),Z=M1(x.output,I,`${H.default.gray(m)}  `);return`${G}${Z}`}case"cancel":{let I=this.options.filter(({value:Q})=>N.includes(Q)).map((Q)=>g(Q,"cancelled")).join(H.default.dim(", "));if(I.trim()==="")return`${G}${H.default.gray(m)}`;let Z=M1(x.output,I,`${H.default.gray(m)}  `);return`${G}${Z}
${H.default.gray(m)}`}case"error":{let I=`${H.default.yellow(m)}  `,Z=this.error.split(`
`).map((X,Y)=>Y===0?`${H.default.yellow(E1)}  ${H.default.yellow(X)}`:`   ${X}`).join(`
`),Q=G.split(`
`).length,K=Z.split(`
`).length+1;return`${G}${I}${Cx({output:x.output,options:this.options,cursor:this.cursor,maxItems:x.maxItems,columnPadding:I.length,rowPadding:Q+K,style:J}).join(`
${I}`)}
${Z}
`}default:{let I=`${H.default.cyan(m)}  `,Z=G.split(`
`).length;return`${G}${I}${Cx({output:x.output,options:this.options,cursor:this.cursor,maxItems:x.maxItems,columnPadding:I.length,rowPadding:Z+2,style:J}).join(`
${I}`)}
${H.default.cyan(E1)}
`}}}}).prompt()},g3=(x)=>H.default.dim(x),$3=(x,g,$)=>{let C={hard:!0,trim:!1},G=w1(x,g,C).split(`
`),N=G.reduce((Z,Q)=>Math.max(g1(Q),Z),0),J=G.map($).reduce((Z,Q)=>Math.max(g1(Q),Z),0),I=g-(J-N);return w1(x,I,C)},p=(x="",g="",$)=>{let C=$?.output??c.stdout,G=($?.withGuide??e.withGuide)!==!1,N=$?.format??g3,J=["",...$3(x,y1(C)-6,N).split(`
`).map(N),""],I=g1(g),Z=Math.max(J.reduce((Y,M)=>{let j=g1(M);return j>Y?j:Y},0),I)+2,Q=J.map((Y)=>`${H.default.gray(m)}  ${Y}${" ".repeat(Z-g1(Y))}${H.default.gray(m)}`).join(`
`),K=G?`${H.default.gray(m)}
`:"",X=G?u4:l4;C.write(`${K}${H.default.green(z0)}  ${H.default.reset(g)} ${H.default.gray(N2.repeat(Math.max(Z-I-1,1))+y4)}
${Q}
${H.default.gray(X+N2.repeat(Z+2)+f4)}
`)};var C3=H.default.magenta,Y0=({indicator:x="dots",onCancel:g,output:$=process.stdout,cancelMessage:C,errorMessage:G,frames:N=$x?["","","",""]:["","o","O","0"],delay:J=$x?80:120,signal:I,...Z}={})=>{let Q=F4(),K,X,Y=!1,M=!1,j="",z,O=performance.now(),q=y1($),B=Z?.styleFrame??C3,D=(W)=>{let k=W>1?G??e.messages.error:C??e.messages.cancel;M=W===1,Y&&(Y1(k,W),M&&typeof g=="function"&&g())},L=()=>D(2),A=()=>D(1),P=()=>{process.on("uncaughtExceptionMonitor",L),process.on("unhandledRejection",L),process.on("SIGINT",A),process.on("SIGTERM",A),process.on("exit",D),I&&I.addEventListener("abort",A)},V=()=>{process.removeListener("uncaughtExceptionMonitor",L),process.removeListener("unhandledRejection",L),process.removeListener("SIGINT",A),process.removeListener("SIGTERM",A),process.removeListener("exit",D),I&&I.removeEventListener("abort",A)},R=()=>{if(z===void 0)return;Q&&$.write(`
`);let W=w1(z,q,{hard:!0,trim:!1}).split(`
`);W.length>1&&$.write(l1.cursor.up(W.length-1)),$.write(l1.cursor.to(0)),$.write(l1.erase.down())},y=(W)=>W.replace(/\.+$/,""),E=(W)=>{let k=(performance.now()-W)/1000,C1=Math.floor(k/60),G1=Math.floor(k%60);return C1>0?`[${C1}m ${G1}s]`:`[${G1}s]`},b=(W="")=>{Y=!0,K=ex({output:$}),j=y(W),O=performance.now(),$.write(`${H.default.gray(m)}
`);let k=0,C1=0;P(),X=setInterval(()=>{if(Q&&j===z)return;R(),z=j;let G1=B(N[k]),t1;if(Q)t1=`${G1}  ${j}...`;else if(x==="timer")t1=`${G1}  ${j} ${E(O)}`;else{let tg=".".repeat(Math.floor(C1)).slice(0,3);t1=`${G1}  ${j}${tg}`}let rg=w1(t1,q,{hard:!0,trim:!1});$.write(rg),k=k+1<N.length?k+1:0,C1=C1<4?C1+0.125:0},J)},Y1=(W="",k=0,C1=!1)=>{if(!Y)return;Y=!1,clearInterval(X),R();let G1=k===0?H.default.green(z0):k===1?H.default.red(Q2):H.default.red(X2);j=W??j,C1||(x==="timer"?$.write(`${G1}  ${j} ${E(O)}
`):$.write(`${G1}  ${j}
`)),V(),K()};return{start:b,stop:(W="")=>Y1(W,0),message:(W="")=>{j=y(W??j)},cancel:(W="")=>Y1(W,1),error:(W="")=>Y1(W,2),clear:()=>Y1("",0,!0),get isCancelled(){return M}}},j6={light:F("","-"),heavy:F("","="),block:F("","#")};var X0=(x,g)=>x.includes(`
`)?x.split(`
`).map(($)=>g($)).join(`
`):g(x),O2=(x)=>{let g=($,C)=>{let G=$.label??String($.value);switch(C){case"disabled":return`${H.default.gray($2)} ${X0(G,H.default.gray)}${$.hint?` ${H.default.dim(`(${$.hint??"disabled"})`)}`:""}`;case"selected":return`${X0(G,H.default.dim)}`;case"active":return`${H.default.green(m4)} ${G}${$.hint?` ${H.default.dim(`(${$.hint})`)}`:""}`;case"cancelled":return`${X0(G,(N)=>H.default.strikethrough(H.default.dim(N)))}`;default:return`${H.default.dim($2)} ${X0(G,H.default.dim)}`}};return new t0({options:x.options,signal:x.signal,input:x.input,output:x.output,initialValue:x.initialValue,render(){let $=`${z2(this.state)}  `,C=`${j2(this.state)}  `,G=M1(x.output,x.message,C,$),N=`${H.default.gray(m)}
${G}
`;switch(this.state){case"submit":{let J=`${H.default.gray(m)}  `,I=M1(x.output,g(this.options[this.cursor],"selected"),J);return`${N}${I}`}case"cancel":{let J=`${H.default.gray(m)}  `,I=M1(x.output,g(this.options[this.cursor],"cancelled"),J);return`${N}${I}
${H.default.gray(m)}`}default:{let J=`${H.default.cyan(m)}  `,I=N.split(`
`).length;return`${N}${J}${Cx({output:x.output,cursor:this.cursor,options:this.options,maxItems:x.maxItems,columnPadding:J.length,rowPadding:I+2,style:(Z,Q)=>g(Z,Z.disabled?"disabled":Q?"active":"inactive")}).join(`
${J}`)}
${H.default.cyan(E1)}
`}}}}).prompt()};var K6=`${H.default.gray(m)}  `;var U=s(W1(),1);import{existsSync as h,mkdirSync as f0,readFileSync as sg,writeFileSync as l0,readdirSync as S9}from"node:fs";import{execSync as ag}from"node:child_process";import{dirname as lx,join as l}from"node:path";import{createHash as W9}from"node:crypto";async function Ix(x,g,{concurrency:$=Number.POSITIVE_INFINITY,stopOnError:C=!0,signal:G}={}){return new Promise((N,J)=>{if(x[Symbol.iterator]===void 0&&x[Symbol.asyncIterator]===void 0)throw TypeError(`Expected \`input\` to be either an \`Iterable\` or \`AsyncIterable\`, got (${typeof x})`);if(typeof g!=="function")throw TypeError("Mapper function is required");if(!(Number.isSafeInteger($)&&$>=1||$===Number.POSITIVE_INFINITY))throw TypeError(`Expected \`concurrency\` to be an integer from 1 and up or \`Infinity\`, got \`${$}\` (${typeof $})`);let I=[],Z=[],Q=new Map,K=!1,X=!1,Y=!1,M=0,j=0,z=x[Symbol.iterator]===void 0?x[Symbol.asyncIterator]():x[Symbol.iterator](),O=()=>{D(G.reason)},q=()=>{G?.removeEventListener("abort",O)},B=(A)=>{N(A),q()},D=(A)=>{K=!0,X=!0,J(A),q()};if(G){if(G.aborted)D(G.reason);G.addEventListener("abort",O,{once:!0})}let L=async()=>{if(X)return;let A=await z.next(),P=j;if(j++,A.done){if(Y=!0,M===0&&!X){if(!C&&Z.length>0){D(AggregateError(Z));return}if(X=!0,Q.size===0){B(I);return}let V=[];for(let[R,y]of I.entries()){if(Q.get(R)===R2)continue;V.push(y)}B(V)}return}M++,(async()=>{try{let V=await A.value;if(X)return;let R=await g(V,P);if(R===R2)Q.set(P,R);I[P]=R,M--,await L()}catch(V){if(C)D(V);else{Z.push(V),M--;try{await L()}catch(R){D(R)}}}})()};(async()=>{for(let A=0;A<$;A++){try{await L()}catch(P){D(P);break}if(Y||K)break}})()})}var R2=Symbol("skip");import{stat as y3}from"fs";import{stat as u3,readdir as f3}from"fs/promises";import{EventEmitter as l3}from"events";import*as _ from"path";import{stat as N3,lstat as q2,readdir as J3,realpath as I3}from"node:fs/promises";import{Readable as Z3}from"node:stream";import{resolve as U2,relative as Q3,join as X3,sep as z3}from"node:path";var d={FILE_TYPE:"files",DIR_TYPE:"directories",FILE_DIR_TYPE:"files_directories",EVERYTHING_TYPE:"all"},Zx={root:".",fileFilter:(x)=>!0,directoryFilter:(x)=>!0,type:d.FILE_TYPE,lstat:!1,depth:2147483648,alwaysStat:!1,highWaterMark:4096};Object.freeze(Zx);var T2="READDIRP_RECURSIVE_ERROR",j3=new Set(["ENOENT","EPERM","EACCES","ELOOP",T2]),B2=[d.DIR_TYPE,d.EVERYTHING_TYPE,d.FILE_DIR_TYPE,d.FILE_TYPE],K3=new Set([d.DIR_TYPE,d.EVERYTHING_TYPE,d.FILE_DIR_TYPE]),Y3=new Set([d.EVERYTHING_TYPE,d.FILE_DIR_TYPE,d.FILE_TYPE]),H3=(x)=>j3.has(x.code),M3=process.platform==="win32",D2=(x)=>!0,A2=(x)=>{if(x===void 0)return D2;if(typeof x==="function")return x;if(typeof x==="string"){let g=x.trim();return($)=>$.basename===g}if(Array.isArray(x)){let g=x.map(($)=>$.trim());return($)=>g.some((C)=>$.basename===C)}return D2};class L2 extends Z3{constructor(x={}){super({objectMode:!0,autoDestroy:!0,highWaterMark:x.highWaterMark});let g={...Zx,...x},{root:$,type:C}=g;this._fileFilter=A2(g.fileFilter),this._directoryFilter=A2(g.directoryFilter);let G=g.lstat?q2:N3;if(M3)this._stat=(N)=>G(N,{bigint:!0});else this._stat=G;this._maxDepth=g.depth??Zx.depth,this._wantsDir=C?K3.has(C):!1,this._wantsFile=C?Y3.has(C):!1,this._wantsEverything=C===d.EVERYTHING_TYPE,this._root=U2($),this._isDirent=!g.alwaysStat,this._statsProp=this._isDirent?"dirent":"stats",this._rdOptions={encoding:"utf8",withFileTypes:this._isDirent},this.parents=[this._exploreDir($,1)],this.reading=!1,this.parent=void 0}async _read(x){if(this.reading)return;this.reading=!0;try{while(!this.destroyed&&x>0){let g=this.parent,$=g&&g.files;if($&&$.length>0){let{path:C,depth:G}=g,N=$.splice(0,x).map((I)=>this._formatEntry(I,C)),J=await Promise.all(N);for(let I of J){if(!I)continue;if(this.destroyed)return;let Z=await this._getEntryType(I);if(Z==="directory"&&this._directoryFilter(I)){if(G<=this._maxDepth)this.parents.push(this._exploreDir(I.fullPath,G+1));if(this._wantsDir)this.push(I),x--}else if((Z==="file"||this._includeAsFile(I))&&this._fileFilter(I)){if(this._wantsFile)this.push(I),x--}}}else{let C=this.parents.pop();if(!C){this.push(null);break}if(this.parent=await C,this.destroyed)return}}}catch(g){this.destroy(g)}finally{this.reading=!1}}async _exploreDir(x,g){let $;try{$=await J3(x,this._rdOptions)}catch(C){this._onError(C)}return{files:$,depth:g,path:x}}async _formatEntry(x,g){let $,C=this._isDirent?x.name:x;try{let G=U2(X3(g,C));$={path:Q3(this._root,G),fullPath:G,basename:C},$[this._statsProp]=this._isDirent?x:await this._stat(G)}catch(G){this._onError(G);return}return $}_onError(x){if(H3(x)&&!this.destroyed)this.emit("warn",x);else this.destroy(x)}async _getEntryType(x){if(!x&&this._statsProp in x)return"";let g=x[this._statsProp];if(g.isFile())return"file";if(g.isDirectory())return"directory";if(g&&g.isSymbolicLink()){let $=x.fullPath;try{let C=await I3($),G=await q2(C);if(G.isFile())return"file";if(G.isDirectory()){let N=C.length;if($.startsWith(C)&&$.substr(N,1)===z3){let J=Error(`Circular symlink detected: "${$}" points to "${C}"`);return J.code=T2,this._onError(J)}return"directory"}}catch(C){return this._onError(C),""}}}_includeAsFile(x){let g=x&&x[this._statsProp];return g&&this._wantsEverything&&!g.isDirectory()}}function _2(x,g={}){let $=g.entryType||g.type;if($==="both")$=d.FILE_DIR_TYPE;if($)g.type=$;if(!x)throw Error("readdirp: root argument is required. Usage: readdirp(root, options)");else if(typeof x!=="string")throw TypeError("readdirp: root argument must be a string. Usage: readdirp(root, options)");else if($&&!B2.includes($))throw Error(`readdirp: Invalid type passed. Use one of ${B2.join(", ")}`);return g.root=x,new L2(g)}import{watchFile as V3,unwatchFile as P2,watch as O3}from"fs";import{open as R3,stat as S2,lstat as q3,realpath as Qx}from"fs/promises";import*as v from"path";import{type as U3}from"os";var B3="data",jx="end",W2="close",O0=()=>{};var R0=process.platform,Kx=R0==="win32",D3=R0==="darwin",A3=R0==="linux",T3=R0==="freebsd",m2=U3()==="OS400",S={ALL:"all",READY:"ready",ADD:"add",CHANGE:"change",ADD_DIR:"addDir",UNLINK:"unlink",UNLINK_DIR:"unlinkDir",RAW:"raw",ERROR:"error"},a=S,L3="watch",_3={lstat:q3,stat:S2},V1="listeners",H0="errHandlers",D1="rawEmitters",P3=[V1,H0,D1],F3=new Set(["3dm","3ds","3g2","3gp","7z","a","aac","adp","afdesign","afphoto","afpub","ai","aif","aiff","alz","ape","apk","appimage","ar","arj","asf","au","avi","bak","baml","bh","bin","bk","bmp","btif","bz2","bzip2","cab","caf","cgm","class","cmx","cpio","cr2","cur","dat","dcm","deb","dex","djvu","dll","dmg","dng","doc","docm","docx","dot","dotm","dra","DS_Store","dsk","dts","dtshd","dvb","dwg","dxf","ecelp4800","ecelp7470","ecelp9600","egg","eol","eot","epub","exe","f4v","fbs","fh","fla","flac","flatpak","fli","flv","fpx","fst","fvt","g3","gh","gif","graffle","gz","gzip","h261","h263","h264","icns","ico","ief","img","ipa","iso","jar","jpeg","jpg","jpgv","jpm","jxr","key","ktx","lha","lib","lvp","lz","lzh","lzma","lzo","m3u","m4a","m4v","mar","mdi","mht","mid","midi","mj2","mka","mkv","mmr","mng","mobi","mov","movie","mp3","mp4","mp4a","mpeg","mpg","mpga","mxu","nef","npx","numbers","nupkg","o","odp","ods","odt","oga","ogg","ogv","otf","ott","pages","pbm","pcx","pdb","pdf","pea","pgm","pic","png","pnm","pot","potm","potx","ppa","ppam","ppm","pps","ppsm","ppsx","ppt","pptm","pptx","psd","pya","pyc","pyo","pyv","qt","rar","ras","raw","resources","rgb","rip","rlc","rmf","rmvb","rpm","rtf","rz","s3m","s7z","scpt","sgi","shar","snap","sil","sketch","slk","smv","snk","so","stl","suo","sub","swf","tar","tbz","tbz2","tga","tgz","thmx","tif","tiff","tlz","ttc","ttf","txz","udf","uvh","uvi","uvm","uvp","uvs","uvu","viv","vob","war","wav","wax","wbmp","wdp","weba","webm","webp","whl","wim","wm","wma","wmv","wmx","woff","woff2","wrm","wvx","xbm","xif","xla","xlam","xls","xlsb","xlsm","xlsx","xlt","xltm","xltx","xm","xmind","xpi","xpm","xwd","xz","z","zip","zipx"]),S3=(x)=>F3.has(v.extname(x).slice(1).toLowerCase()),zx=(x,g)=>{if(x instanceof Set)x.forEach(g);else g(x)},n1=(x,g,$)=>{let C=x[g];if(!(C instanceof Set))x[g]=C=new Set([C]);C.add($)},W3=(x)=>(g)=>{let $=x[g];if($ instanceof Set)$.clear();else delete x[g]},b1=(x,g,$)=>{let C=x[g];if(C instanceof Set)C.delete($);else if(C===$)delete x[g]},v2=(x)=>x instanceof Set?x.size===0:!x,M0=new Map;function F2(x,g,$,C,G){let N=(J,I)=>{if($(x),G(J,I,{watchedPath:x}),I&&x!==I)V0(v.resolve(x,I),V1,v.join(x,I))};try{return O3(x,{persistent:g.persistent},N)}catch(J){C(J);return}}var V0=(x,g,$,C,G)=>{let N=M0.get(x);if(!N)return;zx(N[g],(J)=>{J($,C,G)})},m3=(x,g,$,C)=>{let{listener:G,errHandler:N,rawEmitter:J}=C,I=M0.get(g),Z;if(!$.persistent){if(Z=F2(x,$,G,N,J),!Z)return;return Z.close.bind(Z)}if(I)n1(I,V1,G),n1(I,H0,N),n1(I,D1,J);else{if(Z=F2(x,$,V0.bind(null,g,V1),N,V0.bind(null,g,D1)),!Z)return;Z.on(a.ERROR,async(Q)=>{let K=V0.bind(null,g,H0);if(I)I.watcherUnusable=!0;if(Kx&&Q.code==="EPERM")try{await(await R3(x,"r")).close(),K(Q)}catch(X){}else K(Q)}),I={listeners:G,errHandlers:N,rawEmitters:J,watcher:Z},M0.set(g,I)}return()=>{if(b1(I,V1,G),b1(I,H0,N),b1(I,D1,J),v2(I.listeners))I.watcher.close(),M0.delete(g),P3.forEach(W3(I)),I.watcher=void 0,Object.freeze(I)}},Xx=new Map,v3=(x,g,$,C)=>{let{listener:G,rawEmitter:N}=C,J=Xx.get(g),I=J&&J.options;if(I&&(I.persistent<$.persistent||I.interval>$.interval))P2(g),J=void 0;if(J)n1(J,V1,G),n1(J,D1,N);else J={listeners:G,rawEmitters:N,options:$,watcher:V3(g,$,(Z,Q)=>{zx(J.rawEmitters,(X)=>{X(a.CHANGE,g,{curr:Z,prev:Q})});let K=Z.mtimeMs;if(Z.size!==Q.size||K>Q.mtimeMs||K===0)zx(J.listeners,(X)=>X(x,Z))})},Xx.set(g,J);return()=>{if(b1(J,V1,G),b1(J,D1,N),v2(J.listeners))Xx.delete(g),P2(g),J.options=J.watcher=void 0,Object.freeze(J)}};class Yx{constructor(x){this.fsw=x,this._boundHandleError=(g)=>x._handleError(g)}_watchWithNodeFs(x,g){let $=this.fsw.options,C=v.dirname(x),G=v.basename(x);this.fsw._getWatchedDir(C).add(G);let J=v.resolve(x),I={persistent:$.persistent};if(!g)g=O0;let Z;if($.usePolling){let Q=$.interval!==$.binaryInterval;I.interval=Q&&S3(G)?$.binaryInterval:$.interval,Z=v3(x,J,I,{listener:g,rawEmitter:this.fsw._emitRaw})}else Z=m3(x,J,I,{listener:g,errHandler:this._boundHandleError,rawEmitter:this.fsw._emitRaw});return Z}_handleFile(x,g,$){if(this.fsw.closed)return;let C=v.dirname(x),G=v.basename(x),N=this.fsw._getWatchedDir(C),J=g;if(N.has(G))return;let I=async(Q,K)=>{if(!this.fsw._throttle(L3,x,5))return;if(!K||K.mtimeMs===0)try{let X=await S2(x);if(this.fsw.closed)return;let{atimeMs:Y,mtimeMs:M}=X;if(!Y||Y<=M||M!==J.mtimeMs)this.fsw._emit(a.CHANGE,x,X);if((D3||A3||T3)&&J.ino!==X.ino){this.fsw._closeFile(Q),J=X;let j=this._watchWithNodeFs(x,I);if(j)this.fsw._addPathCloser(Q,j)}else J=X}catch(X){this.fsw._remove(C,G)}else if(N.has(G)){let{atimeMs:X,mtimeMs:Y}=K;if(!X||X<=Y||Y!==J.mtimeMs)this.fsw._emit(a.CHANGE,x,K);J=K}},Z=this._watchWithNodeFs(x,I);if(!($&&this.fsw.options.ignoreInitial)&&this.fsw._isntIgnored(x)){if(!this.fsw._throttle(a.ADD,x,0))return;this.fsw._emit(a.ADD,x,g)}return Z}async _handleSymlink(x,g,$,C){if(this.fsw.closed)return;let G=x.fullPath,N=this.fsw._getWatchedDir(g);if(!this.fsw.options.followSymlinks){this.fsw._incrReadyCount();let J;try{J=await Qx($)}catch(I){return this.fsw._emitReady(),!0}if(this.fsw.closed)return;if(N.has(C)){if(this.fsw._symlinkPaths.get(G)!==J)this.fsw._symlinkPaths.set(G,J),this.fsw._emit(a.CHANGE,$,x.stats)}else N.add(C),this.fsw._symlinkPaths.set(G,J),this.fsw._emit(a.ADD,$,x.stats);return this.fsw._emitReady(),!0}if(this.fsw._symlinkPaths.has(G))return!0;this.fsw._symlinkPaths.set(G,!0)}_handleRead(x,g,$,C,G,N,J){if(x=v.join(x,""),J=this.fsw._throttle("readdir",x,1000),!J)return;let I=this.fsw._getWatchedDir($.path),Z=new Set,Q=this.fsw._readdirp(x,{fileFilter:(K)=>$.filterPath(K),directoryFilter:(K)=>$.filterDir(K)});if(!Q)return;return Q.on(B3,async(K)=>{if(this.fsw.closed){Q=void 0;return}let X=K.path,Y=v.join(x,X);if(Z.add(X),K.stats.isSymbolicLink()&&await this._handleSymlink(K,x,Y,X))return;if(this.fsw.closed){Q=void 0;return}if(X===C||!C&&!I.has(X))this.fsw._incrReadyCount(),Y=v.join(G,v.relative(G,Y)),this._addToNodeFs(Y,g,$,N+1)}).on(a.ERROR,this._boundHandleError),new Promise((K,X)=>{if(!Q)return X();Q.once(jx,()=>{if(this.fsw.closed){Q=void 0;return}let Y=J?J.clear():!1;if(K(void 0),I.getChildren().filter((M)=>{return M!==x&&!Z.has(M)}).forEach((M)=>{this.fsw._remove(x,M)}),Q=void 0,Y)this._handleRead(x,!1,$,C,G,N,J)})})}async _handleDir(x,g,$,C,G,N,J){let I=this.fsw._getWatchedDir(v.dirname(x)),Z=I.has(v.basename(x));if(!($&&this.fsw.options.ignoreInitial)&&!G&&!Z)this.fsw._emit(a.ADD_DIR,x,g);I.add(v.basename(x)),this.fsw._getWatchedDir(x);let Q,K,X=this.fsw.options.depth;if((X==null||C<=X)&&!this.fsw._symlinkPaths.has(J)){if(!G){if(await this._handleRead(x,$,N,G,x,C,Q),this.fsw.closed)return}K=this._watchWithNodeFs(x,(Y,M)=>{if(M&&M.mtimeMs===0)return;this._handleRead(Y,!1,N,G,x,C,Q)})}return K}async _addToNodeFs(x,g,$,C,G){let N=this.fsw._emitReady;if(this.fsw._isIgnored(x)||this.fsw.closed)return N(),!1;let J=this.fsw._getWatchHelpers(x);if($)J.filterPath=(I)=>$.filterPath(I),J.filterDir=(I)=>$.filterDir(I);try{let I=await _3[J.statMethod](J.watchPath);if(this.fsw.closed)return;if(this.fsw._isIgnored(J.watchPath,I))return N(),!1;let Z=this.fsw.options.followSymlinks,Q;if(I.isDirectory()){let K=v.resolve(x),X=Z?await Qx(x):x;if(this.fsw.closed)return;if(Q=await this._handleDir(J.watchPath,I,g,C,G,J,X),this.fsw.closed)return;if(K!==X&&X!==void 0)this.fsw._symlinkPaths.set(K,X)}else if(I.isSymbolicLink()){let K=Z?await Qx(x):x;if(this.fsw.closed)return;let X=v.dirname(J.watchPath);if(this.fsw._getWatchedDir(X).add(J.watchPath),this.fsw._emit(a.ADD,J.watchPath,I),Q=await this._handleDir(X,I,g,C,x,J,K),this.fsw.closed)return;if(K!==void 0)this.fsw._symlinkPaths.set(v.resolve(x),K)}else Q=this._handleFile(J.watchPath,I,g);if(N(),Q)this.fsw._addPathCloser(x,Q);return!1}catch(I){if(this.fsw._handleError(I))return N(),x}}}/*! chokidar - MIT License (c) 2012 Paul Miller (paulmillr.com) */var Hx="/",E3="//",w2=".",w3="..",n3="string",b3=/\\/g,y2=/\/\//,d3=/\..*\.(sw[px])$|~$|\.subl.*\.tmp/,i3=/^\.[/\\]/;function q0(x){return Array.isArray(x)?x:[x]}var Mx=(x)=>typeof x==="object"&&x!==null&&!(x instanceof RegExp);function h3(x){if(typeof x==="function")return x;if(typeof x==="string")return(g)=>x===g;if(x instanceof RegExp)return(g)=>x.test(g);if(typeof x==="object"&&x!==null)return(g)=>{if(x.path===g)return!0;if(x.recursive){let $=_.relative(x.path,g);if(!$)return!1;return!$.startsWith("..")&&!_.isAbsolute($)}return!1};return()=>!1}function k3(x){if(typeof x!=="string")throw Error("string expected");x=_.normalize(x),x=x.replace(/\\/g,"/");let g=!1;if(x.startsWith("//"))g=!0;let $=/\/\//;while(x.match($))x=x.replace($,"/");if(g)x="/"+x;return x}function u2(x,g,$){let C=k3(g);for(let G=0;G<x.length;G++){let N=x[G];if(N(C,$))return!0}return!1}function c3(x,g){if(x==null)throw TypeError("anymatch: specify first argument");let C=q0(x).map((G)=>h3(G));if(g==null)return(G,N)=>{return u2(C,G,N)};return u2(C,g)}var f2=(x)=>{let g=q0(x).flat();if(!g.every(($)=>typeof $===n3))throw TypeError(`Non-string provided as watch path: ${g}`);return g.map(n2)},l2=(x)=>{let g=x.replace(b3,Hx),$=!1;if(g.startsWith(E3))$=!0;while(g.match(y2))g=g.replace(y2,Hx);if($)g=Hx+g;return g},n2=(x)=>l2(_.normalize(l2(x))),E2=(x="")=>(g)=>{if(typeof g==="string")return n2(_.isAbsolute(g)?g:_.join(x,g));else return g},p3=(x,g)=>{if(_.isAbsolute(x))return x;return _.join(g,x)},o3=Object.freeze(new Set);class b2{constructor(x,g){this.path=x,this._removeWatcher=g,this.items=new Set}add(x){let{items:g}=this;if(!g)return;if(x!==w2&&x!==w3)g.add(x)}async remove(x){let{items:g}=this;if(!g)return;if(g.delete(x),g.size>0)return;let $=this.path;try{await f3($)}catch(C){if(this._removeWatcher)this._removeWatcher(_.dirname($),_.basename($))}}has(x){let{items:g}=this;if(!g)return;return g.has(x)}getChildren(){let{items:x}=this;if(!x)return[];return[...x.values()]}dispose(){this.items.clear(),this.path="",this._removeWatcher=O0,this.items=o3,Object.freeze(this)}}var s3="stat",a3="lstat";class d2{constructor(x,g,$){this.fsw=$;let C=x;this.path=x=x.replace(i3,""),this.watchPath=C,this.fullWatchPath=_.resolve(C),this.dirParts=[],this.dirParts.forEach((G)=>{if(G.length>1)G.pop()}),this.followSymlinks=g,this.statMethod=g?s3:a3}entryPath(x){return _.join(this.watchPath,_.relative(this.watchPath,x.fullPath))}filterPath(x){let{stats:g}=x;if(g&&g.isSymbolicLink())return this.filterDir(x);let $=this.entryPath(x);return this.fsw._isntIgnored($,g)&&this.fsw._hasReadPermissions(g)}filterDir(x){return this.fsw._isntIgnored(this.entryPath(x),x.stats)}}class i2 extends l3{constructor(x={}){super();this.closed=!1,this._closers=new Map,this._ignoredPaths=new Set,this._throttled=new Map,this._streams=new Set,this._symlinkPaths=new Map,this._watched=new Map,this._pendingWrites=new Map,this._pendingUnlinks=new Map,this._readyCount=0,this._readyEmitted=!1;let g=x.awaitWriteFinish,$={stabilityThreshold:2000,pollInterval:100},C={persistent:!0,ignoreInitial:!1,ignorePermissionErrors:!1,interval:100,binaryInterval:300,followSymlinks:!0,usePolling:!1,atomic:!0,...x,ignored:x.ignored?q0(x.ignored):q0([]),awaitWriteFinish:g===!0?$:typeof g==="object"?{...$,...g}:!1};if(m2)C.usePolling=!0;if(C.atomic===void 0)C.atomic=!C.usePolling;let G=process.env.CHOKIDAR_USEPOLLING;if(G!==void 0){let I=G.toLowerCase();if(I==="false"||I==="0")C.usePolling=!1;else if(I==="true"||I==="1")C.usePolling=!0;else C.usePolling=!!I}let N=process.env.CHOKIDAR_INTERVAL;if(N)C.interval=Number.parseInt(N,10);let J=0;this._emitReady=()=>{if(J++,J>=this._readyCount)this._emitReady=O0,this._readyEmitted=!0,process.nextTick(()=>this.emit(S.READY))},this._emitRaw=(...I)=>this.emit(S.RAW,...I),this._boundRemove=this._remove.bind(this),this.options=C,this._nodeFsHandler=new Yx(this),Object.freeze(C)}_addIgnoredPath(x){if(Mx(x)){for(let g of this._ignoredPaths)if(Mx(g)&&g.path===x.path&&g.recursive===x.recursive)return}this._ignoredPaths.add(x)}_removeIgnoredPath(x){if(this._ignoredPaths.delete(x),typeof x==="string"){for(let g of this._ignoredPaths)if(Mx(g)&&g.path===x)this._ignoredPaths.delete(g)}}add(x,g,$){let{cwd:C}=this.options;this.closed=!1,this._closePromise=void 0;let G=f2(x);if(C)G=G.map((N)=>{return p3(N,C)});if(G.forEach((N)=>{this._removeIgnoredPath(N)}),this._userIgnored=void 0,!this._readyCount)this._readyCount=0;return this._readyCount+=G.length,Promise.all(G.map(async(N)=>{let J=await this._nodeFsHandler._addToNodeFs(N,!$,void 0,0,g);if(J)this._emitReady();return J})).then((N)=>{if(this.closed)return;N.forEach((J)=>{if(J)this.add(_.dirname(J),_.basename(g||J))})}),this}unwatch(x){if(this.closed)return this;let g=f2(x),{cwd:$}=this.options;return g.forEach((C)=>{if(!_.isAbsolute(C)&&!this._closers.has(C)){if($)C=_.join($,C);C=_.resolve(C)}if(this._closePath(C),this._addIgnoredPath(C),this._watched.has(C))this._addIgnoredPath({path:C,recursive:!0});this._userIgnored=void 0}),this}close(){if(this._closePromise)return this._closePromise;this.closed=!0,this.removeAllListeners();let x=[];return this._closers.forEach((g)=>g.forEach(($)=>{let C=$();if(C instanceof Promise)x.push(C)})),this._streams.forEach((g)=>g.destroy()),this._userIgnored=void 0,this._readyCount=0,this._readyEmitted=!1,this._watched.forEach((g)=>g.dispose()),this._closers.clear(),this._watched.clear(),this._streams.clear(),this._symlinkPaths.clear(),this._throttled.clear(),this._closePromise=x.length?Promise.all(x).then(()=>{return}):Promise.resolve(),this._closePromise}getWatched(){let x={};return this._watched.forEach((g,$)=>{let G=(this.options.cwd?_.relative(this.options.cwd,$):$)||w2;x[G]=g.getChildren().sort()}),x}emitWithAll(x,g){if(this.emit(x,...g),x!==S.ERROR)this.emit(S.ALL,x,...g)}async _emit(x,g,$){if(this.closed)return;let C=this.options;if(Kx)g=_.normalize(g);if(C.cwd)g=_.relative(C.cwd,g);let G=[g];if($!=null)G.push($);let N=C.awaitWriteFinish,J;if(N&&(J=this._pendingWrites.get(g)))return J.lastChange=new Date,this;if(C.atomic){if(x===S.UNLINK)return this._pendingUnlinks.set(g,[x,...G]),setTimeout(()=>{this._pendingUnlinks.forEach((I,Z)=>{this.emit(...I),this.emit(S.ALL,...I),this._pendingUnlinks.delete(Z)})},typeof C.atomic==="number"?C.atomic:100),this;if(x===S.ADD&&this._pendingUnlinks.has(g))x=S.CHANGE,this._pendingUnlinks.delete(g)}if(N&&(x===S.ADD||x===S.CHANGE)&&this._readyEmitted){let I=(Z,Q)=>{if(Z)x=S.ERROR,G[0]=Z,this.emitWithAll(x,G);else if(Q){if(G.length>1)G[1]=Q;else G.push(Q);this.emitWithAll(x,G)}};return this._awaitWriteFinish(g,N.stabilityThreshold,x,I),this}if(x===S.CHANGE){if(!this._throttle(S.CHANGE,g,50))return this}if(C.alwaysStat&&$===void 0&&(x===S.ADD||x===S.ADD_DIR||x===S.CHANGE)){let I=C.cwd?_.join(C.cwd,g):g,Z;try{Z=await u3(I)}catch(Q){}if(!Z||this.closed)return;G.push(Z)}return this.emitWithAll(x,G),this}_handleError(x){let g=x&&x.code;if(x&&g!=="ENOENT"&&g!=="ENOTDIR"&&(!this.options.ignorePermissionErrors||g!=="EPERM"&&g!=="EACCES"))this.emit(S.ERROR,x);return x||this.closed}_throttle(x,g,$){if(!this._throttled.has(x))this._throttled.set(x,new Map);let C=this._throttled.get(x);if(!C)throw Error("invalid throttle");let G=C.get(g);if(G)return G.count++,!1;let N,J=()=>{let Z=C.get(g),Q=Z?Z.count:0;if(C.delete(g),clearTimeout(N),Z)clearTimeout(Z.timeoutObject);return Q};N=setTimeout(J,$);let I={timeoutObject:N,clear:J,count:0};return C.set(g,I),I}_incrReadyCount(){return this._readyCount++}_awaitWriteFinish(x,g,$,C){let G=this.options.awaitWriteFinish;if(typeof G!=="object")return;let N=G.pollInterval,J,I=x;if(this.options.cwd&&!_.isAbsolute(x))I=_.join(this.options.cwd,x);let Z=new Date,Q=this._pendingWrites;function K(X){y3(I,(Y,M)=>{if(Y||!Q.has(x)){if(Y&&Y.code!=="ENOENT")C(Y);return}let j=Number(new Date);if(X&&M.size!==X.size)Q.get(x).lastChange=j;let z=Q.get(x);if(j-z.lastChange>=g)Q.delete(x),C(void 0,M);else J=setTimeout(K,N,M)})}if(!Q.has(x))Q.set(x,{lastChange:Z,cancelWait:()=>{return Q.delete(x),clearTimeout(J),$}}),J=setTimeout(K,N)}_isIgnored(x,g){if(this.options.atomic&&d3.test(x))return!0;if(!this._userIgnored){let{cwd:$}=this.options,G=(this.options.ignored||[]).map(E2($)),J=[...[...this._ignoredPaths].map(E2($)),...G];this._userIgnored=c3(J,void 0)}return this._userIgnored(x,g)}_isntIgnored(x,g){return!this._isIgnored(x,g)}_getWatchHelpers(x){return new d2(x,this.options.followSymlinks,this)}_getWatchedDir(x){let g=_.resolve(x);if(!this._watched.has(g))this._watched.set(g,new b2(g,this._boundRemove));return this._watched.get(g)}_hasReadPermissions(x){if(this.options.ignorePermissionErrors)return!0;return Boolean(Number(x.mode)&256)}_remove(x,g,$){let C=_.join(x,g),G=_.resolve(C);if($=$!=null?$:this._watched.has(C)||this._watched.has(G),!this._throttle("remove",C,100))return;if(!$&&this._watched.size===1)this.add(x,g,!0);this._getWatchedDir(C).getChildren().forEach((X)=>this._remove(C,X));let I=this._getWatchedDir(x),Z=I.has(g);if(I.remove(g),this._symlinkPaths.has(G))this._symlinkPaths.delete(G);let Q=C;if(this.options.cwd)Q=_.relative(this.options.cwd,C);if(this.options.awaitWriteFinish&&this._pendingWrites.has(Q)){if(this._pendingWrites.get(Q).cancelWait()===S.ADD)return}this._watched.delete(C),this._watched.delete(G);let K=$?S.UNLINK_DIR:S.UNLINK;if(Z&&!this._isIgnored(C))this._emit(K,C);this._closePath(C)}_closePath(x){this._closeFile(x);let g=_.dirname(x);this._getWatchedDir(g).remove(_.basename(x))}_closeFile(x){let g=this._closers.get(x);if(!g)return;g.forEach(($)=>$()),this._closers.delete(x)}_addPathCloser(x,g){if(!g)return;let $=this._closers.get(x);if(!$)$=[],this._closers.set(x,$);$.push(g)}_readdirp(x,g){if(this.closed)return;let $={type:S.ALL,alwaysStat:!0,lstat:!0,...g,depth:0},C=_2(x,$);return this._streams.add(C),C.once(W2,()=>{C=void 0}),C.once(jx,()=>{if(C)this._streams.delete(C),C=void 0}),C}}function h2(x,g={}){let $=new i2(g);return $.add(x),$}import{createServer as R9}from"node:http";import{readFileSync as q9,existsSync as U9,readdirSync as a1,statSync as ux,mkdirSync as B9}from"node:fs";import{join as t,basename as og}from"node:path";var M9=s(wg(),1),V9=s(Bx(),1),O9=s(Ax(),1),Wx=s(W0(),1),mx=s(cg(),1);var v0=s(W1(),1),pg=process.env.DASHBOARD_PORT?parseInt(process.env.DASHBOARD_PORT):9847;function D9(){if(process.env.MEMORIES_DIR)return process.env.MEMORIES_DIR;let x=process.argv[3];if(x)return t(x,".serena","memories");return t(process.cwd(),".serena","memories")}function r1(x){try{return q9(x,"utf-8")}catch{return""}}function A9(x){try{let g=a1(x);if(g.includes("orchestrator-session.md"))return t(x,"orchestrator-session.md");let $=g.filter((C)=>/^session-.*\.md$/.test(C)).map((C)=>({name:C,mtime:ux(t(x,C)).mtimeMs})).sort((C,G)=>G.mtime-C.mtime);if($.length>0)return t(x,$[0].name)}catch{}return null}function T9(x){let g=A9(x);if(!g)return{id:"N/A",status:"UNKNOWN"};let $=r1(g);if(!$)return{id:"N/A",status:"UNKNOWN"};let C=($.match(/session-id:\s*(.+)/i)||[])[1]||($.match(/# Session:\s*(.+)/i)||[])[1]||$.match(/(session-\d{8}-\d{6})/)?.[1]||og(g,".md")||"N/A",G="UNKNOWN";if(/IN PROGRESS|RUNNING|## Active|\[IN PROGRESS\]/i.test($))G="RUNNING";else if(/COMPLETED|DONE|## Completed|\[COMPLETED\]/i.test($))G="COMPLETED";else if(/FAILED|ERROR|## Failed|\[FAILED\]/i.test($))G="FAILED";else if(/Step \d+:.*\[/i.test($))G="RUNNING";return{id:C.trim(),status:G}}function L9(x){let g=r1(t(x,"task-board.md"));if(!g)return[];let $=[],C=g.split(`
`);for(let G of C){if(!G.startsWith("|")||/^\|\s*-+/.test(G))continue;let N=G.split("|").map((J)=>J.trim()).filter(Boolean);if(N.length<2||/^agent$/i.test(N[0]))continue;$.push({agent:N[0]||"",status:N[1]||"pending",task:N[2]||""})}return $}function yx(x,g){try{let $=a1(x).filter((N)=>N.startsWith(`progress-${g}`)&&N.endsWith(".md")).sort().reverse();if($.length===0)return null;let G=r1(t(x,$[0])).match(/turn[:\s]*(\d+)/i);return G?parseInt(G[1],10):null}catch{return null}}function _9(x){try{return a1(x).filter(($)=>$.endsWith(".md")&&$!==".gitkeep").map(($)=>({name:$,mtime:ux(t(x,$)).mtimeMs})).sort(($,C)=>C.mtime-$.mtime).slice(0,10).map(($)=>{let C=$.name.replace(/^(progress|result|session|debug|task)-?/,"").replace(/[-_]agent/,"").replace(/[-_]completion/,"").replace(/\.md$/,"").replace(/[-_]/g," ").trim()||$.name.replace(/\.md$/,""),N=r1(t(x,$.name)).split(`
`).map((I)=>I.trim()).filter((I)=>I&&!I.startsWith("---")&&I.length>3),J="";for(let I=N.length-1;I>=0;I--){let Z=N[I];if(/^\*\*|^#+|^-|^\d+\.|Status|Result|Action|Step/i.test(Z)){if(J=Z.replace(/^[#*\-\d.]+\s*/,"").replace(/\*\*/g,"").trim(),J.length>5)break}}if(J.length>80)J=J.substring(0,77)+"...";return{agent:C,message:J,file:$.name}}).filter(($)=>$.message)}catch{return[]}}function P9(x){let g=[],$=new Set;try{let C=a1(x).filter((G)=>G.endsWith(".md")&&G!==".gitkeep").map((G)=>({name:G,mtime:ux(t(x,G)).mtimeMs})).sort((G,N)=>N.mtime-G.mtime);for(let G of C){let N=r1(t(x,G.name)),J=N.match(/\*\*Agent\*\*:\s*(.+)/i)||N.match(/Agent:\s*(.+)/i)||N.match(/^#+\s*(.+?)\s*Agent/im),I=null;if(J)I=J[1].trim();else if(/_agent|agent_|-agent/i.test(G.name))I=G.name.replace(/\.md$/,"").replace(/[-_]completion|[-_]progress|[-_]result/gi,"").replace(/[-_]/g," ").trim();if(I&&!$.has(I.toLowerCase())){$.add(I.toLowerCase());let Z="unknown";if(/\[COMPLETED\]|## Completed|## Results/i.test(N))Z="completed";else if(/\[IN PROGRESS\]|## Progress|IN PROGRESS/i.test(N))Z="running";else if(/\[FAILED\]|## Failed|ERROR/i.test(N))Z="failed";let Q=N.match(/## Task\s*\n+(.+)/i)||N.match(/\*\*Task\*\*:\s*(.+)/i),K=Q?Q[1].trim().substring(0,60):"";g.push({agent:I,status:Z,task:K,turn:yx(x,I)})}}}catch{}return g}function vx(x){let g=T9(x),C=L9(x).map((G)=>({...G,turn:yx(x,G.agent)}));if(C.length===0)C=P9(x);if(C.length===0)try{let G=a1(x).filter((N)=>N.startsWith("progress-")&&N.endsWith(".md"));for(let N of G){let J=N.replace(/^progress-/,"").replace(/\.md$/,"");C.push({agent:J,status:"running",task:"",turn:yx(x,J)})}}catch{}return{session:g,agents:C,activity:_9(x),memoriesDir:x,updatedAt:new Date().toISOString()}}var F9=`<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Serena Memory Dashboard</title>
  <style>
    :root { --bg:#0f0b1a;--surface:#1a1428;--surface-2:#241e33;--border:#3d2e5c;--purple:#9b59b6;--purple-light:#c39bd3;--purple-dark:#6c3483;--text:#e8e0f0;--text-dim:#8a7da0;--green:#2ecc71;--red:#e74c3c;--yellow:#f1c40f;--cyan:#1abc9c; }
    *{margin:0;padding:0;box-sizing:border-box}
    body{background:var(--bg);color:var(--text);font-family:'SF Mono','Fira Code',monospace;min-height:100vh;padding:24px}
    .header{display:flex;align-items:center;gap:16px;margin-bottom:24px;padding-bottom:16px;border-bottom:2px solid var(--border)}
    .logo{width:48px;height:48px;background:linear-gradient(135deg,var(--purple),var(--purple-dark));border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:24px;font-weight:bold;color:white}
    .header-text h1{font-size:20px;color:var(--purple-light)} .header-text .subtitle{font-size:12px;color:var(--text-dim)}
    .connection-badge{margin-left:auto;padding:4px 12px;border-radius:12px;font-size:11px;font-weight:600}
    .connection-badge.connected{background:rgba(46,204,113,0.15);color:var(--green);border:1px solid rgba(46,204,113,0.3)}
    .connection-badge.disconnected{background:rgba(231,76,60,0.15);color:var(--red);border:1px solid rgba(231,76,60,0.3)}
    .connection-badge.connecting{background:rgba(241,196,15,0.15);color:var(--yellow);border:1px solid rgba(241,196,15,0.3)}
    .session-bar{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:16px 20px;margin-bottom:20px;display:flex;align-items:center;gap:20px}
    .session-id{font-size:14px;font-weight:600}
    .session-status{padding:3px 10px;border-radius:6px;font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:0.5px}
    .session-status.running{background:rgba(46,204,113,0.15);color:var(--green)}
    .session-status.completed{background:rgba(26,188,156,0.15);color:var(--cyan)}
    .session-status.failed{background:rgba(231,76,60,0.15);color:var(--red)}
    .session-status.unknown{background:rgba(138,125,160,0.15);color:var(--text-dim)}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:20px} @media(max-width:900px){.grid{grid-template-columns:1fr}}
    .card{background:var(--surface);border:1px solid var(--border);border-radius:8px;overflow:hidden}
    .card-header{padding:12px 16px;border-bottom:1px solid var(--border);font-size:13px;font-weight:600;color:var(--purple-light);background:var(--surface-2)}
    .card-body{padding:16px}
    .agent-table{width:100%;border-collapse:collapse;font-size:13px}
    .agent-table th{text-align:left;padding:8px 12px;color:var(--text-dim);font-weight:500;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:1px solid var(--border)}
    .agent-table td{padding:10px 12px;border-bottom:1px solid rgba(61,46,92,0.4)} .agent-table tr:last-child td{border-bottom:none}
    .status-dot{display:inline-block;width:8px;height:8px;border-radius:50%;margin-right:6px}
    .status-dot.running{background:var(--green);box-shadow:0 0 6px var(--green)} .status-dot.completed{background:var(--cyan)} .status-dot.failed{background:var(--red)} .status-dot.blocked{background:var(--yellow)} .status-dot.pending{background:var(--text-dim)}
    .activity-list{list-style:none;font-size:12px} .activity-list li{padding:8px 0;border-bottom:1px solid rgba(61,46,92,0.3);display:flex;gap:8px} .activity-list li:last-child{border-bottom:none}
    .activity-agent{color:var(--purple-light);font-weight:600;white-space:nowrap} .activity-msg{color:var(--text-dim)}
    .empty{color:var(--text-dim);font-size:12px;font-style:italic;padding:12px 0}
    .footer{margin-top:20px;padding-top:12px;border-top:1px solid var(--border);display:flex;justify-content:space-between;font-size:11px;color:var(--text-dim)}
    @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.4}} .pulse{animation:pulse 2s ease-in-out infinite}
  </style>
</head>
<body>
  <div class="header"><div class="logo">S</div><div class="header-text"><h1>Serena Memory Dashboard</h1><div class="subtitle">Real-time agent orchestration monitor</div></div><div class="connection-badge connecting" id="connBadge">Connecting...</div></div>
  <div class="session-bar"><span>Session:</span><span class="session-id" id="sessionId">N/A</span><span class="session-status unknown" id="sessionStatus">UNKNOWN</span><span style="margin-left:auto;font-size:11px;color:var(--text-dim)" id="updatedAt">--</span></div>
  <div class="grid"><div class="card"><div class="card-header">Agent Status</div><div class="card-body"><table class="agent-table"><thead><tr><th>Agent</th><th>Status</th><th>Turn</th><th>Task</th></tr></thead><tbody id="agentBody"><tr><td colspan="4" class="empty">No agents detected yet</td></tr></tbody></table></div></div><div class="card"><div class="card-header">Latest Activity</div><div class="card-body"><ul class="activity-list" id="activityList"><li class="empty">No activity yet</li></ul></div></div></div>
  <div class="footer"><span>Serena Memory Dashboard</span><span id="footerTime">--</span></div>
  <script>
    const $=s=>document.querySelector(s);
    function normalizeStatus(s){const l=(s||'').toLowerCase();if(['running','active','in_progress','in-progress'].includes(l))return'running';if(['completed','done','finished'].includes(l))return'completed';if(['failed','error'].includes(l))return'failed';if(['blocked','waiting'].includes(l))return'blocked';return'pending'}
    function clearChildren(el){while(el.firstChild)el.removeChild(el.firstChild)}
    function createTextEl(tag,text,cls){const el=document.createElement(tag);el.textContent=text;if(cls)el.className=cls;return el}
    function renderAgents(agents){const tbody=$('#agentBody');clearChildren(tbody);if(!agents||!agents.length){const tr=document.createElement('tr'),td=createTextEl('td','No agents detected yet','empty');td.setAttribute('colspan','4');tr.appendChild(td);tbody.appendChild(tr);return}agents.forEach(a=>{const ns=normalizeStatus(a.status),tr=document.createElement('tr');tr.appendChild(createTextEl('td',a.agent));const std=document.createElement('td'),dot=document.createElement('span');dot.className='status-dot '+ns+(ns==='running'?' pulse':'');std.appendChild(dot);std.appendChild(createTextEl('span',ns,'status-text'));tr.appendChild(std);tr.appendChild(createTextEl('td',a.turn!=null?String(a.turn):'-'));tr.appendChild(createTextEl('td',a.task||''));tbody.appendChild(tr)})}
    function renderActivity(activity){const list=$('#activityList');clearChildren(list);if(!activity||!activity.length){list.appendChild(createTextEl('li','No activity yet','empty'));return}activity.forEach(a=>{const li=document.createElement('li');li.appendChild(createTextEl('span','['+a.agent+']','activity-agent'));li.appendChild(createTextEl('span',a.message,'activity-msg'));list.appendChild(li)})}
    function renderState(state){$('#sessionId').textContent=state.session?.id||'N/A';const st=(state.session?.status||'UNKNOWN').toUpperCase(),sel=$('#sessionStatus');sel.textContent=st;sel.className='session-status '+st.toLowerCase();if(state.updatedAt){const ts=new Date(state.updatedAt).toLocaleString();$('#updatedAt').textContent='Updated: '+ts;$('#footerTime').textContent=ts}renderAgents(state.agents);renderActivity(state.activity)}
    let ws,rd=1000;function connect(){const b=$('#connBadge');b.textContent='Connecting...';b.className='connection-badge connecting';const p=location.protocol==='https:'?'wss:':'ws:';ws=new WebSocket(p+'//'+location.host);ws.onopen=()=>{b.textContent='Connected';b.className='connection-badge connected';rd=1000};ws.onmessage=e=>{try{const m=JSON.parse(e.data);if(m.data)renderState(m.data)}catch{}};ws.onclose=()=>{b.textContent='Disconnected';b.className='connection-badge disconnected';setTimeout(()=>{rd=Math.min(rd*1.5,10000);connect()},rd)};ws.onerror=()=>ws.close()}
    fetch('/api/state').then(r=>r.json()).then(renderState).catch(()=>{});connect();
  </script>
</body>
</html>`;function fx(){let x=D9();if(!U9(x))B9(x,{recursive:!0});let g=R9((J,I)=>{if(J.url==="/api/state")I.writeHead(200,{"Content-Type":"application/json"}),I.end(JSON.stringify(vx(x)));else I.writeHead(200,{"Content-Type":"text/html"}),I.end(F9)}),$=new mx.default({server:g}),C=null;function G(J,I){if(C)clearTimeout(C);C=setTimeout(()=>{let Z=JSON.stringify({type:"update",event:J,file:I,data:vx(x)});$.clients.forEach((Q)=>{if(Q.readyState===Wx.default.OPEN)Q.send(Z)})},100)}let N=h2(x,{persistent:!0,ignoreInitial:!0,awaitWriteFinish:{stabilityThreshold:200,pollInterval:50}});N.on("all",(J,I)=>G(J,og(I))),$.on("connection",(J)=>{J.send(JSON.stringify({type:"full",data:vx(x)})),J.on("error",()=>J.terminate())}),process.on("SIGINT",()=>{console.log(`
Shutting down...`),N.close(),$.clients.forEach((J)=>J.terminate()),$.close(()=>g.close(()=>process.exit(0))),setTimeout(()=>process.exit(1),3000).unref()}),process.on("SIGTERM",()=>process.emit("SIGINT")),g.listen(pg,()=>{console.log(v0.default.magenta(`
  \uD83D\uDEF8 Serena Memory Dashboard`)),console.log(v0.default.white(`     http://localhost:${pg}`)),console.log(v0.default.dim(`     Watching: ${x}
`))})}var y0=process.argv.slice(2);if(y0[0]==="dashboard")fx();else if(y0[0]==="dashboard:web")fx();else if(y0[0]==="update")n9().catch(console.error);else if(y0[0]==="doctor")k9().catch(console.error);else c9().catch(console.error);var Ex="first-fluke/oh-my-antigravity",wx=`https://raw.githubusercontent.com/${Ex}/main/.agent/skills`,Z1={domain:[{name:"frontend-agent",desc:"React/Next.js UI specialist"},{name:"backend-agent",desc:"FastAPI/SQLAlchemy API specialist"},{name:"mobile-agent",desc:"Flutter/Dart mobile specialist"}],coordination:[{name:"pm-agent",desc:"Product manager - task decomposition"},{name:"qa-agent",desc:"QA - OWASP, Lighthouse, WCAG"},{name:"workflow-guide",desc:"Manual multi-agent orchestration"},{name:"orchestrator",desc:"Automated parallel CLI execution"}],utility:[{name:"debug-agent",desc:"Bug fixing specialist"},{name:"commit",desc:"Conventional Commits helper"}]},m9={fullstack:["frontend-agent","backend-agent","pm-agent","qa-agent","debug-agent","commit"],frontend:["frontend-agent","pm-agent","qa-agent","debug-agent","commit"],backend:["backend-agent","pm-agent","qa-agent","debug-agent","commit"],mobile:["mobile-agent","pm-agent","qa-agent","debug-agent","commit"],all:[...Z1.domain,...Z1.coordination,...Z1.utility].map((x)=>x.name)};async function v9(x){let g=["SKILL.md"],$=["resources/execution-protocol.md","resources/tech-stack.md","resources/checklist.md","resources/templates.md","resources/error-playbook.md"];for(let C of $){let G=`${wx}/${x}/${C}`;if((await fetch(G,{method:"HEAD"})).ok)g.push(C)}return g}async function y9(x,g){let $=l(g,".agent","skills",x),C=await v9(x);for(let G of C){let N=`${wx}/${x}/${G}`,J=await fetch(N);if(!J.ok)continue;let I=await J.text(),Z=l($,G),Q=lx(Z);if(!h(Q))f0(Q,{recursive:!0});l0(Z,I,"utf-8")}return!0}function u9(x){return W9("sha256").update(x,"utf-8").digest("hex")}async function f9(x){let g=l(x,".agent","skills","_version.json");if(!h(g))return null;try{let $=sg(g,"utf-8");return JSON.parse($).version||null}catch{return null}}async function l9(x,g){let $=l(x,".agent","skills","_version.json"),C=lx($);if(!h(C))f0(C,{recursive:!0});l0($,JSON.stringify({version:g},null,2),"utf-8")}async function E9(){let x=`https://raw.githubusercontent.com/${Ex}/main/prompt-manifest.json`,g=await fetch(x);if(!g.ok)throw Error("Failed to fetch remote manifest");return await g.json()}async function w9(x){let g=`https://raw.githubusercontent.com/${Ex}/main/${x.path}`,$=await fetch(g);if(!$.ok)return{path:x.path,success:!1,error:`HTTP ${$.status}`};let C=await $.text();if(u9(C)!==x.sha256)return{path:x.path,success:!1,error:"SHA256 mismatch"};let N=l(process.cwd(),x.path),J=lx(N);if(!h(J))f0(J,{recursive:!0});return l0(N,C,"utf-8"),{path:x.path,success:!0}}async function n9(){console.clear(),K0(U.default.bgMagenta(U.default.white(" \uD83D\uDEF8 oh-my-antigravity update ")));let x=process.cwd(),g=Y0();try{g.start("Checking for updates...");let $=await E9(),C=await f9(x);if(C===$.version){g.stop(U.default.green("Already up to date!")),B1(`Current version: ${U.default.cyan(C)}`);return}g.message(`Updating from ${C||"not installed"} to ${U.default.cyan($.version)}...`);let G=await Ix($.files,async(I)=>w9(I),{concurrency:10}),N=G.filter((I)=>!I.success);if(N.length>0)g.stop("Update completed with errors"),p(N.map((I)=>`${U.default.red("")} ${I.path}: ${I.error}`).join(`
`),`${N.length} files failed`);else g.stop(`Updated to version ${U.default.cyan($.version)}!`);await l9(x,$.version);let J=G.length-N.length;B1(N.length>0?`${J} files updated, ${N.length} failed`:`${J} files updated successfully`)}catch($){g.stop("Update failed"),x1.error($ instanceof Error?$.message:String($)),process.exit(1)}}async function b9(x){let g=l(x,".agent","skills","_shared"),$=["reasoning-templates.md","clarification-protocol.md","context-loading.md","skill-routing.md"];if(!h(g))f0(g,{recursive:!0});for(let C of $){let G=`${wx}/_shared/${C}`,N=await fetch(G);if(!N.ok)continue;let J=await N.text();l0(l(g,C),J,"utf-8")}}async function u0(x,g,$){try{let C=ag(`${g} --version`,{encoding:"utf-8",stdio:["pipe","pipe","ignore"]}).trim();return{name:x,installed:!0,version:C,installCmd:$}}catch{return{name:x,installed:!1,installCmd:$}}}async function d9(x){let g=process.env.HOME||process.env.USERPROFILE||"",C={gemini:{path:`${g}/.gemini/settings.json`,type:"json"},claude:{path:`${g}/.claude.json`,type:"json"},codex:{path:`${g}/.codex/config.toml`,type:"toml"}}[x];if(!C)return{configured:!1};if(h(C.path))try{let G=sg(C.path,"utf-8");if(C.type==="json"){let N=JSON.parse(G);return{configured:!!(N.mcpServers||N.mcp),path:C.path}}return{configured:!0,path:C.path}}catch{return{configured:!1}}return{configured:!1}}async function i9(){let x=[];try{ag("which fswatch",{stdio:"ignore"}),x.push({name:"fswatch",available:!0,type:"terminal"})}catch{x.push({name:"fswatch",available:!1,type:"terminal",installCmd:"brew install fswatch (macOS) or apt install inotify-tools (Linux)"})}let g=l(process.cwd(),"scripts","dashboard-web","server.js");if(h(g))try{let $=l(process.cwd(),"node_modules"),C=h(l($,"chokidar")),G=h(l($,"ws"));if(C&&G)x.push({name:"chokidar + ws",available:!0,type:"web"});else x.push({name:"chokidar + ws",available:!1,type:"web",installCmd:"npm install"})}catch{x.push({name:"chokidar + ws",available:!1,type:"web",installCmd:"npm install"})}return x}async function h9(){let x=l(process.cwd(),".agent","skills");if(!h(x))return[];let g=[...Z1.domain,...Z1.coordination,...Z1.utility],$=[];for(let C of g){let G=l(x,C.name),N=l(G,"SKILL.md");$.push({name:C.name,installed:h(G),hasSkillMd:h(N)})}return $}async function k9(){console.clear(),K0(U.default.bgMagenta(U.default.white(" \uD83E\uDE7A oh-my-antigravity doctor ")));let x=process.cwd(),g=Y0();try{g.start("Checking CLI installations...");let $=await Promise.all([u0("gemini","gemini","npm install -g @anthropic-ai/gemini-cli"),u0("claude","claude","npm install -g @anthropic-ai/claude-code"),u0("codex","codex","npm install -g @openai/codex"),u0("qwen","qwen","pip install qwen-cli")]);g.stop("CLI check complete");let C=[U.default.bold("\uD83D\uDD0D CLI Installation Status"),"",` ${U.default.bold("CLI")}      ${U.default.bold("Status")}      ${U.default.bold("Version")}       `,"",...$.map((Y)=>{let M=Y.installed?U.default.green(" Installed"):U.default.red(" Missing"),j=Y.version||"-";return` ${Y.name.padEnd(7)}  ${M.padEnd(8)}  ${j.padEnd(11)} `}),""].join(`
`);p(C,"CLI Status");let G=$.filter((Y)=>!Y.installed);if(G.length>0)p(G.map((Y)=>`${U.default.yellow("")} ${Y.name}: ${U.default.dim(Y.installCmd)}`).join(`
`),"Install missing CLIs");g.start("Checking MCP configurations...");let N=await Promise.all($.filter((Y)=>Y.installed).map(async(Y)=>{let M=await d9(Y.name);return{...Y,mcp:M}}));if(g.stop("MCP check complete"),N.length>0){let Y=[U.default.bold("\uD83D\uDD17 MCP Connection Status"),"",` ${U.default.bold("CLI")}      ${U.default.bold("MCP Config")}  ${U.default.bold("Path")}                `,"",...N.map((M)=>{let j=M.mcp.configured?U.default.green(" Configured"):U.default.yellow("  Not configured"),z=M.mcp.path?M.mcp.path.split("/").pop()||"":"-";return` ${M.name.padEnd(7)}  ${j.padEnd(8)}  ${z.padEnd(19)} `}),""].join(`
`);p(Y,"MCP Status")}g.start("Checking dashboard dependencies...");let J=await i9();g.stop("Dashboard check complete");let I=[U.default.bold("\uD83D\uDCCA Dashboard Dependencies"),"",` ${U.default.bold("Dependency")}       ${U.default.bold("Status")}      ${U.default.bold("Install Command")}                    `,"",...J.map((Y)=>{let M=Y.available?U.default.green(" Available"):U.default.red(" Missing"),j=Y.installCmd||"-";return` ${Y.name.padEnd(15)}  ${M.padEnd(8)}  ${j.padEnd(34)} `}),""].join(`
`);p(I,"Dashboard Status"),g.start("Checking skills installation...");let Z=await h9();if(g.stop("Skills check complete"),Z.length>0){let Y=Z.filter((z)=>z.installed).length,M=Z.filter((z)=>z.hasSkillMd).length,j=[U.default.bold(`\uD83D\uDCE6 Skills (${Y}/${Z.length} installed, ${M} complete)`),"",` ${U.default.bold("Skill")}                 ${U.default.bold("Installed")}  ${U.default.bold("SKILL.md")}    `,"",...Z.map((z)=>{let O=z.installed?U.default.green(""):U.default.red(""),q=z.hasSkillMd?U.default.green(""):U.default.red("");return` ${z.name.padEnd(18)}  ${O.padEnd(8)}  ${q.padEnd(11)} `}),""].join(`
`);p(j,"Skills Status")}else p(U.default.yellow("No skills installed. Run `oh-my-antigravity` to install."),"Skills Status");let Q=l(x,".serena","memories");if(h(Q))try{let Y=S9(Q);p(`${U.default.green("")} Serena memory directory exists
${U.default.dim(`${Y.length} memory files found`)}`,"Serena Memory")}catch{p(U.default.yellow("  Serena directory exists but cannot read files"),"Serena Memory")}else p(`${U.default.yellow("")} Serena memory directory not found
${U.default.dim("Dashboard will show 'No agents detected'")}`,"Serena Memory");let X=G.length+N.filter((Y)=>!Y.mcp.configured).length+J.filter((Y)=>!Y.available).length+(Z.length===0?1:0);if(X===0)B1(U.default.green(" All checks passed! Ready to use."));else B1(U.default.yellow(`  Found ${X} issue(s). See details above.`))}catch($){g.stop("Check failed"),x1.error($ instanceof Error?$.message:String($)),process.exit(1)}}async function c9(){console.clear(),K0(U.default.bgMagenta(U.default.white(" \uD83D\uDEF8 oh-my-antigravity ")));let x=await O2({message:"What type of project?",options:[{value:"all",label:" All",hint:"Install everything"},{value:"fullstack",label:"\uD83C\uDF10 Fullstack",hint:"Frontend + Backend + PM + QA"},{value:"frontend",label:"\uD83C\uDFA8 Frontend",hint:"React/Next.js"},{value:"backend",label:" Backend",hint:"FastAPI/Python"},{value:"mobile",label:"\uD83D\uDCF1 Mobile",hint:"Flutter/Dart"},{value:"custom",label:"\uD83D\uDD27 Custom",hint:"Choose skills"}]});if(v1(x))Jx("Cancelled."),process.exit(0);let g;if(x==="custom"){let G=[...Z1.domain,...Z1.coordination,...Z1.utility],N=await V2({message:"Select skills:",options:G.map((J)=>({value:J.name,label:J.name,hint:J.desc})),required:!0});if(v1(N))Jx("Cancelled."),process.exit(0);g=N}else g=m9[x]??[];let $=process.cwd(),C=Y0();C.start("Installing skills...");try{await b9($);for(let G of g)C.message(`Installing ${U.default.cyan(G)}...`),await y9(G,$);C.stop("Skills installed!"),p([...g.map((G)=>`${U.default.green("")} ${G}`),"",U.default.dim(`Location: ${l($,".agent","skills")}`)].join(`
`),"Installed"),B1(U.default.green("Done! Open your project in your IDE to use the skills."))}catch(G){C.stop("Installation failed"),x1.error(G instanceof Error?G.message:String(G)),process.exit(1)}}

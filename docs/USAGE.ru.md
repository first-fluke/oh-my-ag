# Как использовать мультиагентные навыки Antigravity

## Быстрый старт

1. **Откройте в Antigravity IDE**
   ```bash
   antigravity open /path/to/oh-my-ag
   ```

2. **Навыки определяются автоматически.** Antigravity сканирует `.agent/skills/` и индексирует все доступные навыки.

3. **Используйте чат в IDE.** Опишите, что вы хотите создать.

---

## Примеры использования

### Пример 1: Простая задача в одном домене

**Вы пишете:**
```
"Создай компонент формы входа с полями email и password используя Tailwind CSS"
```

**Что происходит:**
- Antigravity определяет, что это соответствует `frontend-agent`
- Навык загружается автоматически (Постепенное раскрытие)
- Вы получаете React-компонент с TypeScript, Tailwind, валидацией формы

### Пример 2: Сложный мультидоменный проект

**Вы пишете:**
```
"Построй TODO приложение с аутентификацией пользователей"
```

**Что происходит:**

1. **Активируется Workflow Guide** — определяет мультидоменную сложность
2. **PM Agent планирует** — создает разбивку задач с приоритетами
3. **Вы запускаете агентов через CLI**:
   ```bash
   oh-my-ag agent:spawn backend "JWT аутентификация API" session-01 &
   oh-my-ag agent:spawn frontend "Интерфейс входа и TODO" session-01 &
   wait
   ```
4. **Агенты работают параллельно** — сохраняют результаты в Knowledge Base
5. **Вы координируете** — проверяете `.gemini/antigravity/brain/` на согласованность
6. **QA Agent проверяет** — аудит безопасности/производительности
7. **Исправляете и итерируете** — перезапускаете агентов с корректировками

### Пример 3: Исправление багов

**Вы пишете:**
```
"Есть баг — при нажатии на вход показывается 'Cannot read property map of undefined'"
```

**Что происходит:**

1. **Активируется debug-agent** — анализирует ошибку
2. **Найдена первопричина** — компонент проходит по `todos` до загрузки данных
3. **Предоставлено исправление** — добавлены состояния загрузки и проверки на null
4. **Написан регрессионный тест** — гарантирует, что баг не вернется
5. **Найдены похожие паттерны** — проактивно исправляет 3 других компонента

### Пример 4: CLI-основанное параллельное выполнение

```bash
# Один агент (рабочая область автоопределяется)
oh-my-ag agent:spawn backend "Реализовать JWT auth API" session-01

# Параллельные агенты
oh-my-ag agent:spawn backend "Реализовать auth API" session-01 &
oh-my-ag agent:spawn frontend "Создать форму входа" session-01 &
oh-my-ag agent:spawn mobile "Построить экраны аутентификации" session-01 &
wait
```

**Мониторинг в реальном времени:**
```bash
# Терминал (отдельное окно терминала)
bunx oh-my-ag dashboard

# Или браузер
bunx oh-my-ag dashboard:web
# → http://localhost:9847
```

---

## Информационные панели реального времени

### Терминальная панель

```bash
bunx oh-my-ag dashboard
```

Отслеживает `.serena/memories/` используя `fswatch` (macOS) или `inotifywait` (Linux). Отображает живую таблицу со статусом сессии, состояниями агентов, ходами и последней активностью. Обновляется автоматически при изменении файлов памяти.

**Требования:**
- macOS: `brew install fswatch`
- Linux: `apt install inotify-tools`

### Веб-панель

```bash
npm install          # только первый раз
bunx oh-my-ag dashboard:web
```

Откройте `http://localhost:9847` в браузере. Возможности:

- **Обновления в реальном времени** через WebSocket (событийно-управляемые, не опросы)
- **Автоподключение** при разрыве соединения
- **UI в стиле Serena** с фиолетовыми акцентами
- **Статус сессии** — ID и состояние выполнения/завершения/сбоя
- **Таблица агентов** — имя, статус (с цветными точками), количество ходов, описание задачи
- **Журнал активности** — последние изменения из файлов прогресса и результатов

Сервер отслеживает `.serena/memories/` используя chokidar с debounce (100мс). Только измененные файлы инициируют чтение — без полного пересканирования.

---

## Ключевые концепции

### Постепенное раскрытие
Antigravity автоматически сопоставляет запросы с навыками. Вы никогда не выбираете навык вручную. Загружается только необходимый навык в контекст.

### Оптимизированный по токенам дизайн навыков
Каждый навык использует двухслойную архитектуру для максимальной эффективности по токенам:
- **SKILL.md** (~40 строк): Идентичность, маршрутизация, основные правила — загружается немедленно
- **resources/**: Протоколы выполнения, примеры, чек-листы, плейбуки ошибок — загружается по требованию

Общие ресурсы находятся в `_shared/` (не навык) и используются всеми агентами:
- Протоколы выполнения цепочки мыслей с 4-шаговым рабочим процессом
- Few-shot примеры ввода/вывода для руководства моделями среднего уровня
- Плейбуки восстановления после ошибок с эскалацией "3 страйка"
- Шаблоны рассуждений для структурированного многоступенчатого анализа
- Управление бюджетом контекста для уровней моделей Flash/Pro
- Автоматизированная проверка через `verify.sh`
- Накопление выученных уроков между сессиями

### Запуск агентов через CLI
Используйте `oh-my-ag agent:spawn` для запуска агентов через CLI. Учитывает `agent_cli_mapping` в `user-preferences.yaml` для выбора соответствующего CLI (gemini, claude, codex, qwen) для каждого типа агента. Рабочая область автоопределяется из общих соглашений монорепозитория или может быть установлена явно с `-w`.

### Knowledge Base
Результаты работы агентов сохраняются в `.gemini/antigravity/brain/`. Содержит планы, код, отчеты и заметки по координации.

### Serena Memory
Структурированное состояние выполнения в `.serena/memories/`. Оркестратор записывает информацию о сессии, доски задач, прогресс по агентам и результаты. Информационные панели отслеживают эти файлы для мониторинга.

### Рабочие области
Агенты могут работать в отдельных директориях, чтобы избежать конфликтов. Рабочая область автоопределяется из общих соглашений монорепозитория:
```
./apps/api   или ./backend   → Рабочая область Backend Agent
./apps/web   или ./frontend  → Рабочая область Frontend Agent
./apps/mobile или ./mobile   → Рабочая область Mobile Agent
```

---

## Доступные навыки

| Навык | Автоактивируется для | Результат |
|-------|---------------------|-----------|
| workflow-guide | Сложные мультидоменные проекты | Пошаговая координация агентов |
| pm-agent | "спланируй это", "разбей" | `.agent/plan.json` |
| frontend-agent | UI, компоненты, стилизация | React-компоненты, тесты |
| backend-agent | API, базы данных, auth | API-endpoints, модели, тесты |
| mobile-agent | Мобильные приложения, iOS/Android | Flutter-экраны, управление состоянием |
| qa-agent | "проверь безопасность", "аудит" | QA-отчет с приоритизированными исправлениями |
| debug-agent | Отчеты о багах, сообщения об ошибках | Исправленный код, регрессионные тесты |
| orchestrator | CLI выполнение субагентов | Результаты в `.agent/results/` |
| commit | "коммит", "커밋해줘" | Git-коммиты (автоматическое разделение по функциям) |

---

## Команды рабочих процессов

Введите эти команды в чате Antigravity IDE для запуска пошаговых рабочих процессов:

| Команда | Описание |
|---------|----------|
| `/coordinate` | Мультиагентная оркестрация через CLI с пошаговым руководством |
| `/orchestrate` | Автоматизированное CLI-основанное параллельное выполнение агентов |
| `/plan` | Декомпозиция задач PM с API-контрактами |
| `/review` | Полный QA-конвейер (безопасность, производительность, доступность, качество кода) |
| `/debug` | Структурированное исправление багов (воспроизведение → диагностика → исправление → регрессионный тест) |

Это отдельно от **навыков** (которые автоактивируются). Рабочие процессы дают вам явный контроль над многоступенчатыми процессами.

---

## Типовые рабочие процессы

### Рабочий процесс A: Один навык

```
Вы: "Создай компонент кнопки"
  → Antigravity загружает frontend-agent
  → Получаете компонент немедленно
```

### Рабочий процесс B: Мультиагентный проект (Авто)

```
Вы: "Построй TODO приложение с аутентификацией"
  → workflow-guide активируется автоматически
  → PM Agent создает план
  → Вы запускаете агентов через CLI (oh-my-ag agent:spawn)
  → Агенты работают параллельно
  → QA Agent проверяет
  → Исправляете проблемы, итерируете
```

### Рабочий процесс B-2: Мультиагентный проект (Явный)

```
Вы: /coordinate
  → Пошаговый управляемый рабочий процесс
  → Планирование PM → проверка плана → запуск агентов → мониторинг → проверка QA
```

### Рабочий процесс C: Исправление багов

```
Вы: "Кнопка входа выбрасывает TypeError"
  → Активируется debug-agent
  → Анализ первопричины
  → Исправление + регрессионный тест
  → Проверка похожих паттернов
```

### Рабочий процесс D: CLI-оркестрация с информационной панелью

```
Терминал 1: bunx oh-my-ag dashboard:web
Терминал 2: oh-my-ag agent:spawn backend "задача" session-01 &
            oh-my-ag agent:spawn frontend "задача" session-01 &
Браузер:    http://localhost:9847 → статус в реальном времени
```

---

## Советы

1. **Будьте конкретны** — "Построй TODO приложение с JWT auth, React frontend, FastAPI backend" лучше, чем "сделай приложение"
2. **Используйте запуск через CLI** для мультидоменных проектов — не пытайтесь сделать все в одном чате
3. **Проверяйте Knowledge Base** — проверьте `.gemini/antigravity/brain/` на согласованность API
4. **Итерируйте с перезапусками** — уточняйте инструкции, не начинайте заново
5. **Используйте информационные панели** — `bunx oh-my-ag dashboard` или `bunx oh-my-ag dashboard:web` для мониторинга сессий оркестратора
6. **Разделяйте рабочие области** — назначайте каждому агенту свою директорию

---

## Устранение неполадок

| Проблема | Решение |
|----------|---------|
| Навыки не загружаются | `antigravity open .`, проверьте `.agent/skills/`, перезапустите IDE |
| CLI не найден | Проверьте `which gemini` / `which claude`, установите недостающие CLI |
| Несовместимые результаты агентов | Проверьте оба в Knowledge Base, перезапустите с корректировками |
| Панель: "No agents" | Файлы памяти еще не созданы, сначала запустите оркестратор |
| Веб-панель не запускается | Выполните `npm install` для установки chokidar и ws |
| fswatch не найден | macOS: `brew install fswatch`, Linux: `apt install inotify-tools` |
| QA-отчет имеет 50+ проблем | Сначала сфокусируйтесь на CRITICAL/HIGH, остальное задокументируйте на потом |

---

## CLI команды

```bash
bunx oh-my-ag                # Интерактивный установщик навыков
bunx oh-my-ag doctor         # Проверка настройки и восстановление отсутствующих навыков
bunx oh-my-ag doctor --json  # JSON-вывод для CI/CD
bunx oh-my-ag update         # Обновление навыков до последней версии
bunx oh-my-ag stats          # Просмотр метрик продуктивности
bunx oh-my-ag stats --reset  # Сброс метрик
bunx oh-my-ag retro          # Ретроспектива сессии (выводы и следующие шаги)
bunx oh-my-ag dashboard      # Терминальная информационная панель реального времени
bunx oh-my-ag dashboard:web  # Веб-панель (http://localhost:9847)
bunx oh-my-ag help           # Показать справку
```

---

## Для разработчиков (Руководство по интеграции)

Если вы хотите интегрировать эти навыки в существующий проект Antigravity, см. [AGENT_GUIDE.md](../AGENT_GUIDE.md) для:
- Быстрая интеграция в 3 шага
- Полная интеграция информационной панели
- Настройка навыков для вашего технологического стека
- Устранение неполадок и лучшие практики

---

**Просто используйте чат в Antigravity IDE.** Для мониторинга используйте информационные панели. Для выполнения CLI используйте скрипты оркестратора. Для интеграции в существующий проект см. [AGENT_GUIDE.md](../AGENT_GUIDE.md).

---
title: Центральный реестр для мульти-репозиторной конфигурации
description: Использование этого репозитория как версионируемого центрального реестра с безопасной синхронизацией потребительских проектов через обновления на основе PR.
---

# Центральный реестр для мульти-репозиторной конфигурации

Этот репозиторий может служить **центральным реестром** навыков агентов, чтобы несколько потребительских репозиториев оставались согласованными с версионируемыми обновлениями.

## Архитектура

```text
┌─────────────────────────────────────────────────────────┐
│  Центральный реестр (этот репозиторий)                   │
│  • release-please для автоматического версионирования    │
│  • Автогенерация CHANGELOG.md                           │
│  • prompt-manifest.json (версия/файлы/контрольные суммы) │
│  • agent-skills.tar.gz — артефакт релиза                │
└─────────────────────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────┐
│  Потребительский репозиторий                              │
│  • .agent-registry.yaml для фиксации версий              │
│  • Обнаружение новой версии → PR (без авто-слияния)      │
│  • Переиспользуемый Action для синхронизации файлов      │
└─────────────────────────────────────────────────────────┘
```

## Для мейнтейнеров реестра

Релизы автоматизированы через [release-please](https://github.com/googleapis/release-please):

1. Используйте конвенциональные коммиты (`feat:`, `fix:`, `chore:`, ...).
2. Отправляйте в `main` для создания/обновления PR релиза.
3. Слейте PR релиза для публикации артефактов GitHub Release:
   - `CHANGELOG.md` (автосгенерированный)
   - `prompt-manifest.json` (список файлов + контрольные суммы SHA256)
   - `agent-skills.tar.gz` (сжатая директория `.agent/`)

## Для потребительских проектов

Скопируйте шаблоны из `docs/consumer-templates/` в ваш проект:

```bash
# Файл конфигурации
cp docs/consumer-templates/.agent-registry.yaml /path/to/your-project/

# GitHub workflows
cp docs/consumer-templates/check-registry-updates.yml /path/to/your-project/.github/workflows/
cp docs/consumer-templates/sync-agent-registry.yml /path/to/your-project/.github/workflows/
```

Затем зафиксируйте нужную версию в `.agent-registry.yaml`:

```yaml
registry:
  repo: first-fluke/oh-my-ag
  version: "1.2.0"
```

Роли рабочих процессов:

- `check-registry-updates.yml`: проверяет наличие новых версий и создаёт PR.
- `sync-agent-registry.yml`: синхронизирует `.agent/` при изменении зафиксированной версии.

**Важно**: Автоматическое слияние намеренно отключено. Все обновления должны проверяться вручную.

## Использование переиспользуемого Action

Потребительские репозитории могут вызывать действие синхронизации напрямую:

```yaml
- uses: first-fluke/oh-my-ag/.github/actions/sync-agent-registry@main
  with:
    registry-repo: first-fluke/oh-my-ag
    version: "1.2.0" # or "latest"
    github-token: ${{ secrets.GITHUB_TOKEN }}
```
